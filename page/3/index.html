<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.dymox.top","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="TanKingKhun&#39;s Blog">
<meta property="og:url" content="https://blog.dymox.top/page/3/index.html">
<meta property="og:site_name" content="TanKingKhun&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="TanKingKhun">
<meta property="article:tag" content="JavaScript">
<meta property="article:tag" content="Web Front End">
<meta property="article:tag" content="Web前端">
<meta property="article:tag" content="chenjk110">
<meta property="article:tag" content="TanKingKhun">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://blog.dymox.top/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>TanKingKhun's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">TanKingKhun's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2019/12/04/Axios%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E3%80%8C%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8F%96%E6%B6%88%E4%B8%AD%E6%96%ADCancel%E3%80%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/04/Axios%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E3%80%8C%E5%AE%9E%E7%8E%B0%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8F%96%E6%B6%88%E4%B8%AD%E6%96%ADCancel%E3%80%8D/" class="post-title-link" itemprop="url">Axios源码解读「实现请求的取消中断Cancel」</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-05 00:49:57" itemprop="dateCreated datePublished" datetime="2019-12-05T00:49:57+08:00">2019-12-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Cancel类"><a href="#1-Cancel类" class="headerlink" title="1. Cancel类"></a>1. Cancel类</h1><p>Cancel类是定义一个取消操作的实例，主要的实例属性就是message，记录着这次取消动作具体信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.message = message;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.toString = <span class="function"><span class="keyword">function</span> <span class="title">toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'Cancel'</span> + (<span class="keyword">this</span>.message ? <span class="string">': '</span> + <span class="keyword">this</span>.message : <span class="string">''</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Cancel.prototype.__CANCEL__ = <span class="literal">true</span>; <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<h1 id="2-CancelToken类"><a href="#2-CancelToken类" class="headerlink" title="2. CancelToken类"></a>2. CancelToken类</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Cancel = <span class="built_in">require</span>(<span class="string">'./Cancel'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CancelToken</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> executor !== <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'executor must be a function.'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> resolvePromise;</span><br><span class="line">  <span class="comment">// 创建一个promise注入到实例中，将promise的resolve勾出，方便外部调用</span></span><br><span class="line">  <span class="keyword">this</span>.promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> <span class="title">promiseExecutor</span>(<span class="params">resolve</span>) </span>&#123;</span><br><span class="line">    resolvePromise = resolve;</span><br><span class="line">  &#125;);</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">var</span> token = <span class="keyword">this</span>;</span><br><span class="line">  <span class="comment">// 创建CancelToken时候需要在构造函数中传入运行器executor</span></span><br><span class="line">  <span class="comment">// 定义了一个默认的cancel方法作为参数传入</span></span><br><span class="line">  executor(<span class="function"><span class="keyword">function</span> <span class="title">cancel</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (token.reason) &#123;</span><br><span class="line">      <span class="comment">// Cancellation has already been requested</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 将生成带有message取消信息的Cancel实例，赋值给token.reason</span></span><br><span class="line">    token.reason = <span class="keyword">new</span> Cancel(message);</span><br><span class="line">    <span class="comment">// 调用前面勾出的resolve方法，将Cancel实例传入</span></span><br><span class="line">    <span class="comment">// 在后续调用时候可在实例的promise.then回调中获得</span></span><br><span class="line">    resolvePromise(token.reason);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Throws a `Cancel` if cancellation has been requested.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">CancelToken.prototype.throwIfRequested = <span class="function"><span class="keyword">function</span> <span class="title">throwIfRequested</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.reason) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">this</span>.reason;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态实例方法，返回一个对象，token为CancelToken实例，cancel为cancel方法</span></span><br><span class="line">CancelToken.source = <span class="function"><span class="keyword">function</span> <span class="title">source</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cancel;</span><br><span class="line">  <span class="keyword">var</span> token = <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">    cancel = c;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    token: token,</span><br><span class="line">    cancel: cancel</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> cancel</span><br><span class="line"><span class="keyword">const</span> token = <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> <span class="title">executor</span>(<span class="params">c</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 这个c参数就是前面CancelToken类中在executor中定义的cancel函数，</span></span><br><span class="line">  cancel = c</span><br><span class="line">  <span class="comment">// 我们将c的控制权提到外面</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// cancel为函数，可以调用传入message，具体到逻辑为前面定义的方法：</span></span><br><span class="line"><span class="comment">// 先为token.promise注册回调</span></span><br><span class="line">token.promise.then(<span class="function"><span class="params">cancelResult</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(cancelResult.message)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们来进行取消操作， 我们传入的message参数为'Abort!!!'，</span></span><br><span class="line"><span class="comment">// 所以此时会修改CancelToken的状态，这时候token.reason = Cancel&lt;'Abort!!!'&gt;实例</span></span><br><span class="line"></span><br><span class="line">cancel(<span class="string">'Abort!!!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 改变了token的状态后，会执行刚注册的回调，也就是执行：</span></span><br><span class="line"><span class="comment">// console.log(cancelResult.message) -&gt; 'Abort!!!'</span></span><br></pre></td></tr></table></figure>

<h1 id="3-isCancel"><a href="#3-isCancel" class="headerlink" title="3. isCancel"></a>3. isCancel</h1><p>判断是否是Cancel实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">isCancel</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> !!(value &amp;&amp; value.__CANCEL__);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h1 id="文档链接："><a href="#文档链接：" class="headerlink" title="文档链接："></a>文档链接：</h1><p><a href="../Axios源码解读「整体代码文件结构说明」">Axios源码解读「整体代码文件结构说明」</a><br><a href="../Axios源码解读「帮助方法Helpers」">Axios源码解读「帮助方法Helpers」</a><br><a href="../Axios源码解读「通用工具函数」">Axios源码解读「通用工具函数」</a><br><a href="../Axios源码解读「适配器Adapter」">Axios源码解读「适配器Adapter」</a><br><a href="../Axios源码解读「实现请求的取消中断Cancel」">Axios源码解读「实现请求的取消中断Cancel」</a><br><a href="../Axios源码解读「默认配置项default」">Axios源码解读「默认配置项default」</a><br><a href="../Axios源码解读「核心逻辑部分Core」">Axios源码解读「核心逻辑部分Core」</a><br><a href="../Axios源码解读「静态API的注入」">Axios源码解读「静态API的注入」</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2019/12/02/JavaScript%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E7%9A%84%E6%8E%A2%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/02/JavaScript%E7%A7%81%E6%9C%89%E5%8F%98%E9%87%8F%E7%9A%84%E6%8E%A2%E7%A9%B6/" class="post-title-link" itemprop="url">JavaScript私有变量的探究</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-02 14:15:26" itemprop="dateCreated datePublished" datetime="2019-12-02T14:15:26+08:00">2019-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>JavaScript</code>中还没有私有变量标准，先来了解下私有变量是什么，以及都有哪些类型。</p>
<h1 id="1-私有变量的用途"><a href="#1-私有变量的用途" class="headerlink" title="1. 私有变量的用途"></a>1. 私有变量的用途</h1><p>在编程中，私有变量通常作为类或者函数的内部变量，只有特定访问权限的方法才能够获得访问权，一个私有变量不管是类或者实例都无法从外部直接获取、修改，从而实现该变量私有化，保护变量的作用。</p>
<h1 id="2-私有变量的类别"><a href="#2-私有变量的类别" class="headerlink" title="2. 私有变量的类别"></a>2. 私有变量的类别</h1><ol>
<li>实例私有变量</li>
<li>静态私有变量</li>
</ol>
<h1 id="3-静态私有变量"><a href="#3-静态私有变量" class="headerlink" title="3. 静态私有变量"></a>3. 静态私有变量</h1><p>静态私有变量为类定义所具有的属性，所有该类的方法都具有访问权并且变量是共享一份，在此可以借助闭来进行实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> privateStaticVar = <span class="string">'Some private static value'</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 构造函数中进行修改</span></span><br><span class="line">    value !== <span class="literal">undefined</span> &amp;&amp; (privateStaticVar = value)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  Person.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Hello, this is '</span> + privateStaticVar <span class="comment">// 直接返回内容</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 静态方法也可以访问</span></span><br><span class="line">  Person.getPrivateValue = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> privateStaticVar</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> Person</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<p>我们实现了该变量的静态化以及私有化，静态化则是多个实例共享一份，私有化则无法在实例或者类上直接以属性方式获得访问，现在用代码验证下:</p>
<p><img data-src="./WX20191203-010702@2x.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Person.getPrivateValue() <span class="comment">// -&gt; 'Some private static value' 可访问的私有变量</span></span><br><span class="line">Person.privateStaticVar <span class="comment">// -&gt; undefined 无法直接访问的私有变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p1 = <span class="keyword">new</span> Person()</span><br><span class="line">p1.hello() <span class="comment">// -&gt; 'Hello, this is Some private static value' 可访问的私有变量</span></span><br><span class="line">p1.privateStaticVar <span class="comment">// -&gt; undefined 无法直接访问的私有变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p2 = <span class="keyword">new</span> Person(<span class="string">'Person 2'</span>)</span><br><span class="line">p2.privateStaticVar <span class="comment">// -&gt; undefined 无法直接访问的私有变量</span></span><br><span class="line">p2.hello() <span class="comment">// -&gt; 'Hello, this is Person 2' 修改了变量内容</span></span><br><span class="line"></span><br><span class="line">p1.hello() <span class="comment">// -&gt; 'Hello, this is Person 2' 可以发现私有变量是静态化的，实现了多实例共享</span></span><br></pre></td></tr></table></figure>

<h1 id="4-实例私有变量"><a href="#4-实例私有变量" class="headerlink" title="4. 实例私有变量"></a>4. 实例私有变量</h1><p>与私有静态变量意义，这里使用闭包形式来实现私有变量，由于实例的私有变量是各自独立一份不共享，所以这里定义了一个对象作为存储每一份独立的私有变量信息，而我们为每一个实例定义一个<code>_vId</code>属性做为<code>key</code>来进行私有变量仓库的关联:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Person = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 定义每个实例</span></span><br><span class="line">  <span class="keyword">var</span> valueKey = <span class="string">'_vId'</span></span><br><span class="line">  <span class="comment">/* 初始化该类型的私有变量存储对象 */</span></span><br><span class="line">  <span class="keyword">var</span> privateVars = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* 私有静态方法 */</span></span><br><span class="line">  <span class="keyword">var</span> getRandHex = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.random().toString(<span class="number">16</span>).slice(<span class="number">3</span>, <span class="number">-1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Person</span> (<span class="params">lastName</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* 定义`_vId` */</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(<span class="keyword">this</span>, valueKey, &#123; <span class="attr">value</span>: getRandHex() &#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 注册当前实例的私有化变量存储对象中 */</span></span><br><span class="line">    privateVars[<span class="keyword">this</span>[valueKey]] = <span class="built_in">Object</span>.create(&#123;</span><br><span class="line">      <span class="comment">/* 实例私有变量 */</span></span><br><span class="line">      firstName: <span class="string">'private name'</span>,</span><br><span class="line">      age: <span class="number">18</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* 实例私有方法 */</span></span><br><span class="line">      getRandHex: getRandHex.bind(<span class="keyword">this</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 实例变量 */</span></span><br><span class="line">    <span class="keyword">this</span>.lastName = lastName</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Person.prototype = &#123;</span><br><span class="line">    <span class="comment">/* 公有方法 */</span></span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* 私有变量 */</span></span><br><span class="line">      <span class="keyword">var</span> firstName = privateVars[<span class="keyword">this</span>[valueKey]].firstName</span><br><span class="line">      <span class="comment">/* 实例变量 */</span></span><br><span class="line">      <span class="keyword">var</span> lastName = <span class="keyword">this</span>.lastName</span><br><span class="line">      <span class="keyword">return</span> firstName + <span class="string">' '</span> + lastName</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    getUID: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">/* 私有方法 */</span></span><br><span class="line">      <span class="keyword">var</span> getRandHex = privateVars[<span class="keyword">this</span>[valueKey]].getRandHex</span><br><span class="line">      <span class="comment">/* 私有变量 */</span></span><br><span class="line">      <span class="keyword">var</span> firstName = privateVars[<span class="keyword">this</span>[valueKey]].firstName</span><br><span class="line">      <span class="keyword">return</span> firstName + <span class="string">':'</span> + getRandHex()</span><br><span class="line">    &#125;,</span><br><span class="line">    getInfo: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span>  &#123;</span><br><span class="line">        age: privateVars[<span class="keyword">this</span>[valueKey]].age,</span><br><span class="line">        firstName: privateVars[<span class="keyword">this</span>[valueKey]].firstName,</span><br><span class="line">        lastName: <span class="keyword">this</span>.lastName,</span><br><span class="line">        uid: <span class="keyword">this</span>.getUID()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Person</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">'Jack'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(p)</span><br></pre></td></tr></table></figure>

<p>从上面代码可以看出，我们定义了两个私有变量一个实例变量，三个公有方法，和一个私有方法，我们来测试下代码，看看能否按照我们的意愿执行：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> Person(<span class="string">'Jack'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(p)</span><br></pre></td></tr></table></figure>

<p><img data-src="./WX20191202-135043@2x.png" alt="PersonInstance"></p>
<p>可以发现，符合预期，然后我们来继续测试下其他的私有变量和私有方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.getInfo()</span><br></pre></td></tr></table></figure>
<p><img data-src="./WX20191202-140648@2x.png" alt="PersonInstance"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.getUID()</span><br></pre></td></tr></table></figure>
<p><img data-src="./WX20191202-140849@2x.png" alt="PersonInstance"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p.getName()</span><br></pre></td></tr></table></figure>
<p><img data-src="./WX20191202-141054@2x.png" alt="PersonInstance"></p>
<p>可以看出变量与方法私有化使得使用更加安全，避免了外部的访问而导致的修改。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2019/12/01/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAPromise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/12/01/%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAPromise/" class="post-title-link" itemprop="url">实现一个Promise</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-02 00:16:53" itemprop="dateCreated datePublished" datetime="2019-12-02T00:16:53+08:00">2019-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-定义构造函数"><a href="#1-定义构造函数" class="headerlink" title="1. 定义构造函数"></a>1. 定义构造函数</h1><p>我们打算定一个Promise类，就取名为<code>SimplePromise</code>吧：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>这时候我们就有个<code>SimplePromise</code>类了，那么就创建一个Promise试下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise()</span><br></pre></td></tr></table></figure>

<p>我们有了一个Promise实例了，但这个其实就是一个类别是<code>SimplePromise</code>的普通对象，还有就是，我们希望创建这个对象的时候是通过<code>new</code>关键字去实现的，而不是直接调用函数，所以接着我们在构造方法添加一下限制条件，就是判断实例是否是<code>SimplePromise</code>类型，因为直接调用的话，<code>this</code>指向是不确定的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-1-添加状态属性：-state"><a href="#1-1-添加状态属性：-state" class="headerlink" title="1.1 添加状态属性：_state"></a>1.1 添加状态属性：_state</h2><p>增加了这个条件限制，就能限定构造函数的使用方式了。接着我们得为<code>SimplePromise</code>添加一些实例属性，比如当前的Promise状态，先来看下Promise具体有什么状态：</p>
<ul>
<li>pending</li>
<li>resolved</li>
<li>rejected</li>
<li>settled</li>
</ul>
<p>在新建一个Promise时候，状态是<code>pending</code>的，然后会有两个状态分歧，<code>resolved</code>和<code>rejected</code>，而这两个状态都可被称为<code>settled</code>的状态，所以实际上我们用除了<code>settled</code>以外的三个状态进行区别即可。那么接下来让我们来问题构造函数添加状态属性，并且默认赋予<code>pending状</code>态值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = <span class="string">'STATE_PENDING'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们为Promise添加了一个可以识别状态的属性，我们再创建一个实例试试：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(p) <span class="comment">// -&gt; &#123;_state: "STATE_PENDING"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(SimplePromise.STATE_PENDING) <span class="comment">// -&gt; 'STATE_PENDING'</span></span><br></pre></td></tr></table></figure>



<h2 id="1-2-添加值属性：-value"><a href="#1-2-添加值属性：-value" class="headerlink" title="1.2 添加值属性：_value"></a>1.2 添加值属性：_value</h2><p>有了状态属性，接着看下有没有其他属性可以添加，我们知道每一个Promise不管是resolve或reject都会携带一个具体的值，所以接下来我们打算添加一个属性用来存放Promise的值，默认就定为<code>undefined</code>，这个步骤很简单:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = <span class="string">'STATE_PENDING'</span></span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这时候的<code>SimplePromise</code>的数据结构就初步有了样子，我们下一步开始考虑为其添加原型方法了，然后去实现Promise该有的链式调用功能。</p>
<h2 id="1-3-在构造函数中添加运行器：executor"><a href="#1-3-在构造函数中添加运行器：executor" class="headerlink" title="1.3 在构造函数中添加运行器：executor"></a>1.3 在构造函数中添加运行器：executor</h2><p>我们在实例化Promise时，需要传入一个运行函数<code>executor</code>，我们直接使用<code>executor.call()</code>方式来执行，当<code>executor</code>不是一个函数时候，则会在实例化过程中抛出异常，导致实例化失败，这也是硬性要求传入的必须是函数，但是为了方便我们内部调用时候实例化一个空的Promise，我们预先定义一个空函数<code>noop</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = <span class="string">'STATE_PENDING'</span></span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  </span><br><span class="line">  executor.call(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="2-添加静态状态属性"><a href="#2-添加静态状态属性" class="headerlink" title="2. 添加静态状态属性"></a>2. 添加静态状态属性</h1><p>为了方便调用使用，我们准备将三个状态定义成常量，并且挂载在<code>SimplePromise</code>类中，实现静态化，然后修改下刚刚构造函数中默认状态的赋值方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  </span><br><span class="line">  executor.call(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-添加原型方法"><a href="#3-添加原型方法" class="headerlink" title="3. 添加原型方法"></a>3. 添加原型方法</h1><p>在Promise中有三个原型方法分别是：<code>then</code>、<code>catch</code>、<code>finally</code>，我们将在原型对象<code>prototype</code>中添加上去。</p>
<h2 id="3-1-添加then原型方法"><a href="#3-1-添加then原型方法" class="headerlink" title="3.1 添加then原型方法"></a>3.1 添加then原型方法</h2><p><code>then</code>原型方法有两个参数，分别是Promise两个状态对应的回调函数：</p>
<ul>
<li>onFulfilled</li>
<li>onRejected</li>
</ul>
<p>所以，我们在实现<code>then</code>方法的同时，需要为Promise添加一个实例属性，用来存放注册的回调函数，我们将这个变量定义成一个数组，然后每次执行<code>then</code>方法，都会将回调函数以<strong>[onFulfilled, onRejected]</strong>数据结构推入，形成一个回调处理的队列形式，且返回实例<code>this</code>以实现链式方法调用。</p>
<p>所以接下来我们添加一个实例属性<code>_callbacks</code>和一个原型方法<code>then</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">this</span>._callbacks = []</span><br><span class="line">  </span><br><span class="line">  executor.call(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFulfilled, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-2-添加catch原型方法"><a href="#3-2-添加catch原型方法" class="headerlink" title="3.2 添加catch原型方法"></a>3.2 添加catch原型方法</h2><p><code>catch</code>方法是<code>onRejected</code>实现的别名，可以在then中传入<code>onRejected</code>实现相同的效果。当你的Promise状态变为<code>rejected</code>时或者任意一个环节抛出了异常，则会触发回调函数，所以<code>catch</code>方法传入的回调只有一个<code>onRejcted</code>函数，用来处理以上所说的情况，我们来实现一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">this</span>._callbacks = []</span><br><span class="line">  </span><br><span class="line">  executor.call(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFulfilled, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([<span class="literal">undefined</span>, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-3-添加finally原型方法"><a href="#3-3-添加finally原型方法" class="headerlink" title="3.3 添加finally原型方法"></a>3.3 添加finally原型方法</h2><p><code>Promise.finally</code>方法在Promise实例不管是<code>resolved</code>还是<code>rejected</code>都会被执行，由于都会被执行可以理解为<code>onFinally</code>即是<code>onFulfilled</code>也是<code>onRejected</code>，所以代码可以这样实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">this</span>._callbacks = []</span><br><span class="line">  </span><br><span class="line">  executor.call(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFulfilled, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([<span class="literal">undefined</span>, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">onFinally</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFinally, onFinally])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-4-添加私有原型方法"><a href="#3-4-添加私有原型方法" class="headerlink" title="3.4 添加私有原型方法"></a>3.4 添加私有原型方法</h2><p>现在常用的回调注册方法都完成了，但由于Promise的回调是异步的，中间流程涉及到回调链的处理，回调返回值的处理等等，接下来我们得进一步去完成包括：</p>
<ul>
<li>改变状态的处理方法：``_handleResolve<code>、</code>_handleReject`</li>
<li>不同状态的回调链处理方法： <code>_runCallbacks</code></li>
</ul>
<h3 id="3-4-1-改变状态的处理方法"><a href="#3-4-1-改变状态的处理方法" class="headerlink" title="3.4.1 改变状态的处理方法"></a>3.4.1 改变状态的处理方法</h3><p>在<code>executor</code>函数中有两个参数分别为<code>resolve</code>、<code>reject</code>的函数，这两个函数分别实现修改当前Promise实例的状态，并触发后续的一系列回调执行。这边实现的方式是分别在原型中定义这两个私有方法，然后在<code>executor</code>调用中把这两个方法以参数形式传入，这两个方法主要作用是修改当前实例的状态和值，并且开始执行对应状态的回调链，接下来分别实现改变状态的两个处理方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">this</span>._callbacks = []</span><br><span class="line">  </span><br><span class="line">  executor.call(</span><br><span class="line">    <span class="keyword">this</span>, </span><br><span class="line">    <span class="keyword">this</span>._handleResolve.bind(<span class="keyword">this</span>),</span><br><span class="line">    <span class="keyword">this</span>._handleReject.bind(<span class="keyword">this</span>)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFulfilled, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([<span class="literal">undefined</span>, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">onFinally</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFinally, onFinally])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._handleResolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_RESOLVED</span><br><span class="line">  <span class="keyword">this</span>._value = value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._handleReject = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_REJECTED</span><br><span class="line">  <span class="keyword">this</span>._value = value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-处理状态回调链的方法"><a href="#3-4-2-处理状态回调链的方法" class="headerlink" title="3.4.2 处理状态回调链的方法"></a>3.4.2 处理状态回调链的方法</h3><p>我们将按顺序取出存于<code>_callbacks</code>数组中的回调函数对，然后根据当前状态去执行回调函数，例如现在的状态是<code>resolved</code>则有一下基本的几个流程：</p>
<ol>
<li>取出回调函数对：[onFulfilled, onRejected]</li>
<li>根据当前状态为<code>resolved</code>执行<code>onFulfilled</code>函数并获得返回结果</li>
<li>根据结果类型判断是否继续执行下一个回调，然后递归调用处理方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line"><span class="keyword">var</span> noop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">this</span>._callbacks = []</span><br><span class="line">  </span><br><span class="line">  executor.call(</span><br><span class="line">    <span class="keyword">this</span>, </span><br><span class="line">    <span class="keyword">this</span>._handleResolve.bind(<span class="keyword">this</span>),</span><br><span class="line">    <span class="keyword">this</span>._handleReject.bind(<span class="keyword">this</span>)</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFulfilled, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([<span class="literal">undefined</span>, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">onFinally</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFinally, onFinally])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._handleResolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cb = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._state = SimplePromise.STATE_RESOLVED</span><br><span class="line">    <span class="keyword">this</span>._value = value</span><br><span class="line">    <span class="keyword">this</span>._runCallbacks()</span><br><span class="line">  &#125;).bind(<span class="keyword">this</span>)</span><br><span class="line">  </span><br><span class="line">  setTimeout(cb, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._handleReject = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cb = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._state = SimplePromise.STATE_REJECTED</span><br><span class="line">    <span class="keyword">this</span>._value = value</span><br><span class="line">    <span class="keyword">this</span>._runCallbacks()</span><br><span class="line">  &#125;).bind(<span class="keyword">this</span>)</span><br><span class="line">  </span><br><span class="line">  setTimeout(cb, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._runCallbacks = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cbPair = <span class="keyword">this</span>._callbacks.shift()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cbPair === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._value <span class="keyword">instanceof</span> <span class="built_in">Error</span>) <span class="keyword">throw</span> <span class="keyword">this</span>._value</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> cb</span><br><span class="line">  <span class="keyword">var</span> result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._state === SimplePromise.STATE_RESOLVED) &#123;</span><br><span class="line">    cb = cbPair[<span class="number">0</span>]</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>._state === SimplePromise.STATE_REJECTED) &#123;</span><br><span class="line">    cb = cbPair[<span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (cb === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="keyword">this</span>._runCallbacks()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(noop)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = cb.call(<span class="keyword">this</span>, <span class="keyword">this</span>._value)</span><br><span class="line">    <span class="keyword">if</span> (result <span class="keyword">instanceof</span> SimplePromise) &#123;</span><br><span class="line">      p = result</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      p._state = <span class="keyword">this</span>._state</span><br><span class="line">      p._value = result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(noop)</span><br><span class="line">    p._state = SimplePromise.STATE_REJECTED</span><br><span class="line">    p._value = err</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  p._callbacks = <span class="keyword">this</span>._callbacks.concat()</span><br><span class="line">  </span><br><span class="line">  setTimeout(p._runCallbacks.bind(p), <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-5-添加静态方法"><a href="#3-5-添加静态方法" class="headerlink" title="3.5 添加静态方法"></a>3.5 添加静态方法</h2><p>Promise中有<code>resolve</code>、<code>reject</code>、<code>all</code>、<code>race</code>这四个静态方法，我们也将他们实现一下。</p>
<h3 id="3-5-1-静态方法resolve"><a href="#3-5-1-静态方法resolve" class="headerlink" title="3.5.1 静态方法resolve"></a>3.5.1 静态方法resolve</h3><p><code>Promise.resolve()</code>会直接返回一个状态为<code>resolved</code>的实例，这时候我们直接利用前面定义的一些私有方法来进行实现，具体的实现逻辑为：</p>
<ol>
<li>创建一个实例 <code>p</code></li>
<li>修改实例的状态为<code>resolved</code></li>
<li>修改实例的值为传入的值</li>
<li>异步执行<code>_runCallbacks</code></li>
<li>返回实例</li>
</ol>
<p>利用<code>setTimeout</code>我们可以实现将<code>_runCallbacks</code>推入到宏任务队列中去。以上的步骤，我们在前面已经实现了一个<code>_handleResolve</code>的私有方法，直接调用即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SimplePromise.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(noop)</span><br><span class="line">  p._handleResolve()</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-2-静态方法reject"><a href="#3-5-2-静态方法reject" class="headerlink" title="3.5.2 静态方法reject"></a>3.5.2 静态方法reject</h3><p>流程与上面相似，这边直接看代码实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.reject = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(noop)</span><br><span class="line">  p._handleReject(value)</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-3-静态方法all"><a href="#3-5-3-静态方法all" class="headerlink" title="3.5.3 静态方法all"></a>3.5.3 静态方法all</h3><p><code>Promise.all</code>返回一个Promise实例，当传入的所有Promise状态都为<code>resolved</code>或者非Promise默认为<code>resolve</code>，则该状态变为<code>resolved</code>，若其中有一个为<code>rejected</code>则状态为<code>rejected</code>且值为第一个失败的Promise的值，这里的实现方案是：</p>
<ol>
<li>判断传入的值，若其中一个为<code>rejected</code>的Promise实例则直接结束流程</li>
<li>创建一个新的实例、统一成功回调、统一失败回调、结果值数组</li>
<li>成功回调判断计数</li>
<li>失败回调直接返回错误</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.all = <span class="function"><span class="keyword">function</span> (<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> results = []</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(noop)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> onFulfilled = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    results.push(value)</span><br><span class="line">    <span class="keyword">if</span> (results.length === list.length) &#123;</span><br><span class="line">      p._handleResolve(results)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> onRejected = <span class="function"><span class="keyword">function</span> (<span class="params">errValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p._state === SimplePromise.STATE_PENDING) &#123;</span><br><span class="line">      p._handleReject(errValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  list.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">beChecked</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(beChecked <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">      SimplePromise.resolve(beChecked).then(onFulfilled)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      beChecked.then(onFulfilled, onRejected)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-5-4-静态方法race"><a href="#3-5-4-静态方法race" class="headerlink" title="3.5.4 静态方法race"></a>3.5.4 静态方法race</h3><p><code>Promise.race</code>只要其中一个实例<code>resolved</code>或者<code>rejected</code>，则返回的实例就相同，实现逻辑为：</p>
<ol>
<li>新建一个实例<code>p</code></li>
<li>定义统一成功回调、统一失败回调</li>
<li>任意一个回调被触发则判断实例<code>p</code>的状态，若不为<code>pending</code>则直接<code>return</code></li>
<li>若<code>p</code>状态为<code>pending</code>，则改变<code>p</code>状态</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.race = <span class="function"><span class="keyword">function</span> (<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(noop)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> onFulfilled = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p._state !== SimplePromise.STATE_PENDING) <span class="keyword">return</span></span><br><span class="line">    p._handleResolve(value)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> onRejected = <span class="function"><span class="keyword">function</span> (<span class="params">errValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p._state !== SimplePromise.STATE_PENDING) <span class="keyword">return</span></span><br><span class="line">    p._handleReject(errValue)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  list.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">beChecked</span>) </span>&#123;</span><br><span class="line">    beChecked.then(onFulfilled, onRejected)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="4-完整代码"><a href="#4-完整代码" class="headerlink" title="4. 完整代码"></a>4. 完整代码</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line">SimplePromise.STATE_PENDING = <span class="string">'STATE_PENDING'</span></span><br><span class="line">SimplePromise.STATE_RESOLVED = <span class="string">'STATE_RESOLVED'</span></span><br><span class="line">SimplePromise.STATE_REJECTED = <span class="string">'STATE_REJECTED'</span></span><br><span class="line">SimplePromise.NOOP = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SimplePromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!(<span class="keyword">this</span> <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'should be called with `new`.'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>._state = SimplePromise.STATE_PENDING</span><br><span class="line">  <span class="keyword">this</span>._value = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">this</span>._callbacks = []</span><br><span class="line">  </span><br><span class="line">  executor.call(</span><br><span class="line">    <span class="keyword">this</span>,</span><br><span class="line">    <span class="keyword">this</span>._handleResolve.bind(<span class="keyword">this</span>),</span><br><span class="line">    <span class="keyword">this</span>._handleReject.bind(<span class="keyword">this</span>)</span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFulfilled, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.catch = <span class="function"><span class="keyword">function</span> (<span class="params">onRejected</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([<span class="literal">undefined</span>, onRejected])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype.finally = <span class="function"><span class="keyword">function</span> (<span class="params">onFinally</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._callbacks.push([onFinally, onFinally])</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._handleResolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cb = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._state = SimplePromise.STATE_RESOLVED</span><br><span class="line">    <span class="keyword">this</span>._value = value</span><br><span class="line">    <span class="keyword">this</span>._runCallbacks()</span><br><span class="line">  &#125;).bind(<span class="keyword">this</span>)</span><br><span class="line">  </span><br><span class="line">  setTimeout(cb, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._handleReject = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cb = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._state = SimplePromise.STATE_REJECTED</span><br><span class="line">    <span class="keyword">this</span>._value = value</span><br><span class="line">    <span class="keyword">this</span>._runCallbacks()</span><br><span class="line">  &#125;).bind(<span class="keyword">this</span>)</span><br><span class="line">  </span><br><span class="line">  setTimeout(cb, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.prototype._runCallbacks = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> cbPair = <span class="keyword">this</span>._callbacks.shift()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cbPair === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._value <span class="keyword">instanceof</span> <span class="built_in">Error</span>) <span class="keyword">throw</span> <span class="keyword">this</span>._value</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> cb</span><br><span class="line">  <span class="keyword">var</span> result</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>._state === SimplePromise.STATE_RESOLVED) &#123;</span><br><span class="line">    cb = cbPair[<span class="number">0</span>]</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">this</span>._state === SimplePromise.STATE_REJECTED) &#123;</span><br><span class="line">    cb = cbPair[<span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (cb === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="keyword">this</span>._runCallbacks()</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(SimplePromise.NOOP)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> result = cb.call(<span class="keyword">this</span>, <span class="keyword">this</span>._value)</span><br><span class="line">    <span class="keyword">if</span> (result <span class="keyword">instanceof</span> SimplePromise) &#123;</span><br><span class="line">      p = result</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      p._state = <span class="keyword">this</span>._state</span><br><span class="line">      p._value = result</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">    p._state = SimplePromise.STATE_REJECTED</span><br><span class="line">    p._value = err</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  p._callbacks = <span class="keyword">this</span>._callbacks.concat()</span><br><span class="line">  </span><br><span class="line">  setTimeout(p._runCallbacks.bind(p), <span class="number">0</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.resolve = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(SimplePromise.NOOP)</span><br><span class="line">  p._handleResolve(value)</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.reject = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(SimplePromise.NOOP)</span><br><span class="line">  p._handleReject(value)</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.all = <span class="function"><span class="keyword">function</span> (<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> results = []</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(SimplePromise.NOOP)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> onFulfilled = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    results.push(value)</span><br><span class="line">    <span class="keyword">if</span> (results.length === list.length) &#123;</span><br><span class="line">      p._handleResolve(results)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> onRejected = <span class="function"><span class="keyword">function</span> (<span class="params">errValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p._state === SimplePromise.STATE_PENDING) &#123;</span><br><span class="line">      p._handleReject(errValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  list.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">beChecked</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(beChecked <span class="keyword">instanceof</span> SimplePromise)) &#123;</span><br><span class="line">      SimplePromise.resolve(beChecked).then(onFulfilled)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      beChecked.then(onFulfilled, onRejected)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SimplePromise.race = <span class="function"><span class="keyword">function</span> (<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = <span class="keyword">new</span> SimplePromise(SimplePromise.NOOP)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> onFulfilled = <span class="function"><span class="keyword">function</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p._state !== SimplePromise.STATE_PENDING) <span class="keyword">return</span></span><br><span class="line">    p._handleResolve(value)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> onRejected = <span class="function"><span class="keyword">function</span> (<span class="params">errValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p._state !== SimplePromise.STATE_PENDING) <span class="keyword">return</span></span><br><span class="line">    p._handleReject(errValue)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  list.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">beChecked</span>) </span>&#123;</span><br><span class="line">    beChecked.then(onFulfilled, onRejected)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h4><p><a href="https://promisesaplus.com/" target="_blank" rel="noopener">Promise/A+</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">MDN</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2019/11/30/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/30/%E6%89%8B%E5%86%99%E4%B8%80%E4%B8%AA%E8%BF%AD%E4%BB%A3%E5%99%A8/" class="post-title-link" itemprop="url">手写一个迭代器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-30 20:53:37" itemprop="dateCreated datePublished" datetime="2019-11-30T20:53:37+08:00">2019-11-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>迭代器（Iterator）的功能是作为一种统一访问序列数据结构的工具，本文主要是根据<code>JavaScript</code>中的<code>Generator</code>函数和<code>Iterator</code>接口的定义来实现该功能。</p>
<h1 id="1-Iterator迭代器"><a href="#1-Iterator迭代器" class="headerlink" title="1. Iterator迭代器"></a>1. Iterator迭代器</h1><p><strong>构造函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Iterator</span>(<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<p><strong>实例属性：</strong></p>
<ul>
<li>_done       状态</li>
<li>_values     值列表</li>
<li>_idx           迭代指针</li>
<li>_length       值列表长度</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Iterator</span>(<span class="params">values</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>._done   = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">this</span>._values = values</span><br><span class="line">  <span class="keyword">this</span>._idx    = <span class="number">-1</span></span><br><span class="line">  <span class="keyword">this</span>._length = values.length</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>原型方法：</strong></p>
<ul>
<li>next       执行一次迭代</li>
<li>return    返回迭代值并结束迭代</li>
<li>throw     抛出异常并结束迭代</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Iterator.prototype = &#123;</span><br><span class="line">  <span class="keyword">constructor</span>: Iterator,</span><br><span class="line">  next: function (nextValue) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._done) &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">done</span>: <span class="literal">true</span>, <span class="attr">value</span>: <span class="literal">undefined</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> done = <span class="keyword">this</span>._done</span><br><span class="line">    <span class="keyword">var</span> value = <span class="keyword">this</span>._values[++<span class="keyword">this</span>._idx]</span><br><span class="line"></span><br><span class="line">    value = nextValue !== <span class="literal">undefined</span> ? nextValue : value</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>._idx === <span class="keyword">this</span>._length) <span class="keyword">this</span>._done = <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">value</span>: value, <span class="attr">done</span>: done &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">return</span>: <span class="function"><span class="keyword">function</span> (<span class="params">nextValue</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._done = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">value</span>: nextValue, <span class="attr">done</span>: <span class="literal">true</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">throw</span>: <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>._done = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">throw</span> error <span class="keyword">instanceof</span> <span class="built_in">Error</span> ? error : <span class="keyword">new</span> <span class="built_in">Error</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-Generator生成器"><a href="#2-Generator生成器" class="headerlink" title="2. Generator生成器"></a>2. Generator生成器</h1><p>生成器作用是统一转化可迭代的对象并返回生成器，比如传入的数据结构为数组、对象、字符串等，根据不同类型处理成可遍历的数据结构。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Generator</span>(<span class="params">targetValue</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> getRawType = <span class="built_in">Object</span>.prototype.toString</span><br><span class="line">  <span class="keyword">var</span> values = []</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">var</span> type = getRawType.call(targetValue)</span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'[object Array]'</span>) &#123;</span><br><span class="line">    values = targetValue.concat()</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'[object Object]'</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">in</span> targetValue) &#123;</span><br><span class="line">      values.push(targetValue[key])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'[object String]'</span>) &#123;</span><br><span class="line">    values = targetValue.split(<span class="string">''</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Iterator(values)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h1><p>1.数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="string">'Apple'</span>, <span class="string">'Orange'</span>, <span class="string">'Banana'</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = Generator(list)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: "Apple", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: "Orange", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: "Banana", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>2.对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  name: <span class="string">'Jack'</span>,</span><br><span class="line">  age: <span class="number">21</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = Generator(person)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: "Jack", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: 21, done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>3.字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> words = <span class="string">'HelloWorld'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = Generator(words)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: "H", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: "e", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: "l", done: false&#125;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: "d", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>4.return(value)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = Generator(list)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">it.return(<span class="number">-1</span>) <span class="comment">// &#123;value: -1, done: true&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>5.throw(Error)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = Generator(list)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  it.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'SomeError'</span>))</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err.message) <span class="comment">// -&gt; 'SomeError'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>6.next(value)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="keyword">const</span> it = Generator(list)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line">it.next(<span class="number">-1</span>) <span class="comment">// &#123;value: -1, done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: 3, done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2019/11/27/JavaScript%E9%87%8D%E8%A6%81%E7%B1%BB%E5%9E%8B%E3%80%8CFunction%E3%80%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/27/JavaScript%E9%87%8D%E8%A6%81%E7%B1%BB%E5%9E%8B%E3%80%8CFunction%E3%80%8D/" class="post-title-link" itemprop="url">JavaScript重要类型「Function」</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-27 21:41:25" itemprop="dateCreated datePublished" datetime="2019-11-27T21:41:25+08:00">2019-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-函数的类型"><a href="#1-函数的类型" class="headerlink" title="1. 函数的类型"></a>1. 函数的类型</h1><p>首先来了解下JavaScript中到目前标准为止都有哪些函数：</p>
<ul>
<li>普通具名函数</li>
<li>普通匿名函数</li>
<li>生成器函数</li>
<li>箭头函数</li>
<li>异步函数</li>
</ul>
<h2 id="1-1-普通具名函数"><a href="#1-1-普通具名函数" class="headerlink" title="1.1 普通具名函数"></a>1.1 普通具名函数</h2><p>普通具名函数的通用结构形式：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function [函数名] (参数1, 参数2, ..., 参数255) &#123; [语句] &#125;</span><br></pre></td></tr></table></figure>

<p>通常我们在使用一个函数时候，需要定义一个函数，普通具名函数通过function关键字进行定义函数，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上我们定义的了一个名称为<code>name</code>的函数，该方式定义的函数具有变量提升特性，也就是说，在当前作用域下，可以在定义之前进行调用，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hello() <span class="comment">// 可以在定义之前调用：'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'hello'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了以上定义的方式，也可以进行直接量定义，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hello = <span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>直接量的定义方式，则不允许在定义赋值完成前进行调用，这个其实与变量定义提升规则一样，具体可以参考变量提升。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a() <span class="comment">// 在定义前进行调用，发生错误</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span> <span class="title">name</span> (<span class="params"></span>) </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">a() <span class="comment">// 正常调用</span></span><br></pre></td></tr></table></figure>

<p><strong>Tips - 关于变量提升</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原始代码</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// -&gt; undefined</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'hello'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的实现为</span></span><br><span class="line"><span class="keyword">var</span> a <span class="comment">// a的定义已经提升到最前面</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// a已经定义，但未初始化，所以此时为undefined</span></span><br><span class="line"></span><br><span class="line">a = <span class="string">'hello'</span> <span class="comment">// a完成初始化</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 之后对a进行访问则能获得其值 -&gt; "hello"</span></span><br></pre></td></tr></table></figure>

<p>在直接量定义时候，函数名可以省了，因为对于直接量定义时候，函数名只具有在该语句的作用域可获得，此时的作用域则限定在定义的函数里，若有具体引用需求则可以附加函数名，否则通常是以匿名函数形式进行定义，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="function"><span class="keyword">function</span> <span class="title">name</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 在函数作用域内可以获得name函数，函数体外作用域则无法获得name函数</span></span><br><span class="line">  <span class="built_in">console</span>.log(name) <span class="comment">// 则打印此函数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(name) <span class="comment">// 此处无法获得name函数，发生错误</span></span><br><span class="line"></span><br><span class="line">a() <span class="comment">// 若要调用name则使用a变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 匿名函数方式</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-2-匿名函数"><a href="#1-2-匿名函数" class="headerlink" title="1.2 匿名函数"></a>1.2 匿名函数</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">参数<span class="number">1</span>, 参数<span class="number">2</span>, ..., 参数<span class="number">255</span></span>) </span>&#123; [语句] &#125;</span><br></pre></td></tr></table></figure>

<p>匿名函数必须通过直接量进行定义或者自行函数(IIFE)，无法使用像具名函数那样直接定义，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 发生错误，必须要有函数名</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 正常初始化</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;) <span class="comment">// 正常执行语句、返回funciton直接量</span></span><br><span class="line"></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;)() <span class="comment">// 完成调用，实现自行</span></span><br></pre></td></tr></table></figure>

<p>通常我们用匿名函数来做直接量的赋值操作，例如为对象属性进行赋值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">  <span class="comment">/* speak 被定义为一个函数 */</span></span><br><span class="line">  speak: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">person.walk = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125; <span class="comment">// 另一种赋值</span></span><br></pre></td></tr></table></figure>

<p>或者是使用IIFE来实现作用域隔离：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自行实现函数隔离作变量作用域</span></span><br><span class="line"><span class="keyword">const</span> result = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> id = <span class="built_in">Math</span>.random().toString(<span class="number">16</span>).slice(<span class="number">3</span>, <span class="number">-1</span>)</span><br><span class="line">  <span class="keyword">var</span> frameKey = <span class="string">'UID'</span></span><br><span class="line">  <span class="keyword">return</span> frameKey + <span class="string">':'</span> + id</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// result -&gt; 为随机的序列</span></span><br></pre></td></tr></table></figure>

<p>对于回调函数的使用：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> box = <span class="built_in">document</span>.getElementById(<span class="string">'box'</span>)</span><br><span class="line">box.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'click box!'</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<p>可以看出，由于JavaScript的灵活，我们可以在使用函数的地方完全可以不用提前声明，直接利用匿名函数可以使编码更加简便。</p>
<h2 id="1-3-箭头函数"><a href="#1-3-箭头函数" class="headerlink" title="1.3 箭头函数"></a>1.3 箭头函数</h2><p>在ES6标准中，增加了箭头函数类型，这种函数除了简便书写外，最主要的特性是自动绑定上下文，这个特性可以在连续使用箭头函数时候直接传递上下文this，对于上下文内容后文将会提到，首先来看下如何书写一个箭头函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(参数<span class="number">1</span>, 参数<span class="number">2</span>, ..., 参数<span class="number">255</span>) =&gt; &#123; 语句 &#125;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">参数<span class="number">1</span> =&gt; 表达式</span><br></pre></td></tr></table></figure>

<p>箭头函数的定义和普通函数定义方式不一样，箭头函数的定义是直接量的，不能像普通函数那样声明：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通函数声明</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">name</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数声明</span></span><br><span class="line"><span class="keyword">const</span> hello = <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>我们来看下箭头函数和普通函数的对比：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通函数 `sum`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a + b</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 箭头函数 `sum`</span></span><br><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">a, b</span>) =&gt;</span> a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 普通函数 `fn1`</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 箭头函数 `fn1`</span></span><br><span class="line"><span class="keyword">const</span> fn1 = <span class="function"><span class="params">n</span> =&gt;</span> n + <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>使用箭头函数来实现高阶函数的嵌套是非常方便的，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通函数的高阶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b + c</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>)(<span class="number">3</span>) <span class="comment">// -&gt; 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 箭头函数的使用</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function"><span class="params">a</span> =&gt;</span> <span class="function"><span class="params">b</span> =&gt;</span> <span class="function"><span class="params">c</span> =&gt;</span> a + b + c <span class="comment">// 一行即可实现</span></span><br></pre></td></tr></table></figure>

<p>对于箭头函数的两个有点：</p>
<ul>
<li><p>书写简便</p>
</li>
<li><p>上下文自动绑定</p>
</li>
</ul>
<p>这两个特性足够让我们经常使用它。</p>
<h2 id="1-4-生成器函数"><a href="#1-4-生成器函数" class="headerlink" title="1.4 生成器函数"></a>1.4 生成器函数</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function* [名称](参数1, 参数2, ..., 参数255) &#123; [语句] &#125;</span><br></pre></td></tr></table></figure>

<p>Generator函数是作为迭代生成器的一种特殊函数，通过关键字<code>yield</code>来定义每一步迭代关键步骤。通常使用迭代器，我们可以更方便地按顺序去访问一个数组，我们先用普通函数实现一个简单的迭代器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createIterator</span>(<span class="params">values</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> _value = <span class="literal">undefined</span>, _done = <span class="literal">false</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">next</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_done) <span class="keyword">return</span> &#123; <span class="attr">value</span>: <span class="literal">undefined</span>, <span class="attr">done</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    _done = !values.length</span><br><span class="line">    _value = values.shift()</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">value</span>: _value, <span class="attr">done</span>: _done &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> &#123; next &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> list = [<span class="string">'apple'</span>, <span class="string">'orange'</span>, <span class="string">'banana'</span>]</span><br><span class="line"><span class="keyword">const</span> it = createIterator(list)</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: "apple", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: "orange", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: "banana", done: false&#125; 到达最后一个值</span></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: undefined, done: true&#125; 已经完成迭代</span></span><br></pre></td></tr></table></figure>

<p>从上面可看出，我们每次调用<code>it.next()</code>, 数组的访问指针就会移动一格，并且返回本次迭代对应的值以及当前迭代器的状态，访问流程可以按需的去进行，灵活方便。对于原生的Generator函数，则用也一致，并且具有更多的灵活性和不同的定义方式，我们来看下原生Generator函数基本使用方式：</p>
<ul>
<li>yield 关键字定义迭代输出标志</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createFruitIt</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'apple'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'orange'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'banana'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = createFruitIt()</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: "apple", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: "orange", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: "banana", done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// -&gt; &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>原生generator函数需要使用关键字<code>yield</code>定义每次迭代的输出值，我们也可以穿入数组来进行迭代：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createIterator</span>(<span class="params">list</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; list.length; i++) &#123;</span><br><span class="line">    <span class="keyword">yield</span> list[i]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createIterator</span>(<span class="params">list</span>) </span>&#123;</span><br><span class="line">  list.forEach(<span class="function"><span class="params">value</span> =&gt;</span> <span class="keyword">yield</span> value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>next()</code> 方法执行下一次迭代，若在执行时候传入值，则将值赋予上一次迭代的<code>yield</code>关键字左侧</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">const</span> x = <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">yield</span> x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> it = gen()</span><br><span class="line">it.next() <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">it.next(<span class="number">-1</span>) <span class="comment">// &#123; value: -1, done: false &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>调用<code>next()</code>，输出第一个<code>yield</code>关键字右值，输出为1，并在此阻塞`</p>
</li>
<li><p>调用<code>next()</code>，继续执行，输出第二个<code>yield</code>关键字右值，输出2，并在此阻塞，且此时<code>x</code>等待下次<code>next()</code>传入的值</p>
</li>
<li><p>调用<code>next(-1)</code>，继续执行，输入第三个<code>yield</code>关键字右值，输出-1， 由于这次调用传入了值<code>-1</code>，则会赋值到第二步中<code>yield</code>关键字左值，所以本次迭代实质执行了逻辑为：</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="number">-1</span></span><br><span class="line"><span class="keyword">yield</span> x <span class="comment">// -&gt; -1</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>调用 <code>next()</code>，结束迭代，<code>done: false</code>，<code>value: undefined</code></li>
</ol>
<p>可以看出每次迭代的顺序及逻辑都是以<code>yield</code>为分界点，<code>yield</code>右侧定义了本次迭代的输出，左侧则为下次迭代的输入，流程类似一条<code>S</code>形绳子，每个<code>yield</code>类似绳子打的结，顺着绳子开端捋过去，则会在绳结处卡住，相当于阻塞；过一个绳结，继续捋，相当于下一次迭；直到手碰到下一个绳结，意味着当次迭代完成；用一下代码做一下简单事例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* a.开始位置 */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* a. &gt;&gt;&gt; 执行代码 &gt;&gt;&gt; b. */</span></span><br><span class="line">                                           </span><br><span class="line">  <span class="comment">/* c.[下次迭代的输入] &lt;&lt;&lt; */</span> <span class="keyword">yield</span> <span class="number">0</span> <span class="comment">/* &lt;在此阻塞&gt; &lt;&lt;&lt; [本次迭代输出] &lt;&lt;&lt; b. */</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* c. &gt;&gt;&gt; 执行代码 &gt;&gt;&gt; d. */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* e. &lt;&lt;&lt; [下次迭代的输入] &lt;&lt;&lt; */</span> <span class="keyword">yield</span> <span class="number">1</span> <span class="comment">/* d. &lt;在此阻塞&gt; &lt;&lt;&lt; [本次迭代输出] d. */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* e. &gt;&gt;&gt; 最后一次迭代执行代码 &gt;&gt;&gt; 结束 */</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/* e.结束位置 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>对于<code>yield</code>的右值可以是普通的数据，也可以是一个Generator生成器，形成嵌套组合，著名的<code>co</code>库就是利用这种方法实现一部迭代嵌套，后文将提及的<code>AsyncFunction</code>作用与此异曲同工，我们先来利用<code>Generator</code>体验一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">serialize</span>(<span class="params">n</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span>(i &lt; n) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">print</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span>* serialize(<span class="number">3</span>) <span class="comment">// 利用yield* 移交控制权</span></span><br><span class="line">  <span class="keyword">yield</span>* serialize(<span class="number">5</span>) <span class="comment">// 利用yield* 移交控制权</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'done'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = print()</span><br><span class="line"><span class="keyword">let</span> val</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(val = p.next(), !val.done) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(val)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 输出 */</span></span><br><span class="line"><span class="comment">/* &#123; value: 0, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 1, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 2, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 0, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 1, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 2, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 3, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 4, done: false &#125; */</span></span><br><span class="line"><span class="comment">/* &#123; value: 'done', done: false &#125; */</span></span><br></pre></td></tr></table></figure>

<p>利用<code>yield*</code>关键字可以将当前迭代器的控制权交予右边迭代器，当下一次迭代时候，则进入该子迭代器继续，完成子迭代器的迭代后，则交还控制权，继续当前迭代，利用这种特性我们可以使用多层嵌套迭代器来实现栈相似功能，从而实现异步回调的嵌套。</p>
<p>在<code>generator</code>函数中，若中途<code>return</code>则将会改变迭代器的状态为完成状态，即<code>done: true</code>，<code>return</code>语句之后的<code>yield</code>关键字则被忽略，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在执行两次的<code>next()</code>后，第三次迭代会直接返回<code>-1</code>，从而第三个<code>yield</code>则无效，从<code>value</code>的值从而被替换成<code>-1</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> it = gen()</span><br><span class="line">it.next() <span class="comment">// &#123; value: 1, done: false &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: 2, done: false &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: -1, done: true &#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123; value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>

<p>当我们在获得了需要的值时候，之后的迭代则没有意义了，有了这个机制，可以让我们灵活从函数内部去控制在何时结束迭代。但这种方式仅限于一开始函数定义时固定的控制流程，当我们在外部使用迭代器的时候，有时需要随时结束迭代，以方便我们的具体需求，<code>Generator</code>函数定义了一个原型方法<code>return()</code>，该方法与内部的<code>return</code>关键字作用相同，也是改变迭代器的状态以及将传入的值作为结果值的<code>value</code>, 如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">nums</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">0</span></span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">yield</span> i++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">it = nums()</span><br><span class="line"></span><br><span class="line">it.next() <span class="comment">// &#123;value: 0, done: false&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: 9, done: false&#125;</span></span><br></pre></td></tr></table></figure>

<p>在迭代返回值的<code>value</code>为9时候，下一次迭代则为10，我们利用<code>return()</code>方法替代<code>next()</code>方法完成下一次迭代，从而结束迭代， 若继续调用<code>next()</code>则会发现迭代器已经是结束状态：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">it.return(<span class="number">10</span>) <span class="comment">// &#123;value: 10, done: true&#125;</span></span><br><span class="line">it.next() <span class="comment">// &#123;value: undefined, done: true &#125;</span></span><br></pre></td></tr></table></figure>



<p>在迭代器的异常处理中，同样的也提供了一个<code>throw()</code>方法，这个方法可以在外部人为干预地让迭代器抛出异常，调用时传入一个错误实例，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">gen</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">       <span class="keyword">yield</span> <span class="number">42</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Error caught!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> g = gen();</span><br><span class="line">g.next(); <span class="comment">// &#123; value: 42, done: false &#125;</span></span><br><span class="line">g.throw(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"Something went wrong"</span>)); <span class="comment">// "Error caught!"</span></span><br></pre></td></tr></table></figure>

<h2 id="1-5-异步函数"><a href="#1-5-异步函数" class="headerlink" title="1.5 异步函数"></a>1.5 异步函数</h2><p>异步函数可以看作是普通函数的异步增强，提供了<code>await</code>关键字，与Promise结合可以简便异步流程控制，提高异步链式回调的可读性，首先来看下如何定义一个异步函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span> (<span class="params">参数<span class="number">1</span>, ..., 参数N</span>) </span>&#123; <span class="comment">/* 代码 */</span> &#125;</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"><span class="keyword">async</span> (参数<span class="number">1</span>, ..., 参数N) =&gt; &#123; <span class="comment">/* 代码 */</span> &#125;</span><br></pre></td></tr></table></figure>
<p>定一个一个异步函数与普通函数大致相同，需要使用<code>async</code>关键字，异步函数的返回值总会是一个<code>Promise</code>实例，这个与普通函数不同：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'hello'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'world'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(fn1()) <span class="comment">// 'hello'</span></span><br><span class="line"><span class="built_in">console</span>.log(fn2()) <span class="comment">// Promise &#123;&lt;resolved&gt;: "world"&#125;</span></span><br></pre></td></tr></table></figure>

<p>在异步函数执行后，由于返回的是Proimse实例，我们可以像操作Promise那样进行如<code>then</code>、<code>catch</code>等链式操作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">'hello world'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn1().then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res) <span class="comment">// 'hello world'</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Boom!'</span>)</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(err.message) <span class="comment">// 'Boom!'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-5-1-异步函数返回的Promise状态"><a href="#1-5-1-异步函数返回的Promise状态" class="headerlink" title="1.5.1 异步函数返回的Promise状态"></a>1.5.1 异步函数返回的Promise状态</h3><p>我们知道Promise核心的有两个状态：<code>resolved</code>、<code>rejected</code>，那么在什么情况下会返回对应的这两种状态的Promise，我们来看下：</p>
<p><strong>resolved:</strong></p>
<ul>
<li>返回任何正常值（不return返回值默认为undefined）</li>
<li>返回Proimse.resove()</li>
</ul>
<p><strong>rejected:</strong></p>
<ul>
<li>抛出异常</li>
<li>返回Promise.reject()</li>
</ul>
<h4 id="返回resolved状态"><a href="#返回resolved状态" class="headerlink" title="返回resolved状态:"></a>返回<code>resolved</code>状态:</h4><p>1.返回正常值：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">async</span> val =&gt; val</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1(<span class="string">'abc'</span>)) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: "abc"&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1(<span class="literal">true</span>)) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: true&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1(<span class="number">0</span>)) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: 0&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1(&#123;&#125;)) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: &#123;&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1([])) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: []&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1(<span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;)) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: f&#125;</span></span><br></pre></td></tr></table></figure>

<p>2.不返回</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">async</span> () =&gt; &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(f1()) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: undefined&#125;</span></span><br></pre></td></tr></table></figure>

<p>3.返回错误</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">async</span> () =&gt; <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Boom!'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(f1())</span><br><span class="line"><span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: Error: Boom ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>4.返回<code>Promise.resove()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">async</span> () =&gt; <span class="built_in">Promise</span>.resolve(<span class="string">'done!!'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(f1()) <span class="comment">// -&gt; Promise &#123;&lt;resolved&gt;: 'done'&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="返回rejected状态"><a href="#返回rejected状态" class="headerlink" title="返回rejected状态:"></a>返回<code>rejected</code>状态:</h4><p>1.抛出异常</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">async</span> () =&gt; &#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Something Wrong!'</span>) &#125;</span><br><span class="line"><span class="built_in">console</span>.log(f1()) <span class="comment">// -&gt; Promise &#123;&lt;rejected&gt;: Error: Something Wrong! ...&#125;</span></span><br></pre></td></tr></table></figure>

<p>2.返回<code>Promise.reject()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> f1 = <span class="keyword">async</span> () =&gt; <span class="built_in">Promise</span>.reject(<span class="string">'No!'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(f1()) <span class="comment">// -&gt;  Promise &#123;&lt;rejected&gt;: 'No!'&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="返回状态总结："><a href="#返回状态总结：" class="headerlink" title="返回状态总结："></a>返回状态总结：</h4><p>所以可以知道，除了抛出异常与<code>Promise.reject()</code>实例的返回值状态为<code>rejected</code>，其余都是<code>resolved</code>状态</p>
<h3 id="1-5-2-异步函数await关键字"><a href="#1-5-2-异步函数await关键字" class="headerlink" title="1.5.2 异步函数await关键字"></a>1.5.2 异步函数<code>await</code>关键字</h3><p>异步函数最大的一个特点就是能够将Promise异步请求像写同步函数那样串起来，利用<code>await</code>关键字实现异步等待，类似迭代器，这样可以方便异步流程的顺序执行，先来看下<code>await</code>的用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义延迟函数</span></span><br><span class="line"><span class="keyword">const</span> delay = <span class="function">(<span class="params">delay</span>) =&gt;</span> </span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> </span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`delayed: <span class="subst">$&#123;delay&#125;</span>ms`</span>)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;, delay)</span><br><span class="line">  )</span><br><span class="line"><span class="keyword">const</span> f1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  delay(<span class="number">1000</span>)</span><br><span class="line">  delay(<span class="number">1000</span>)</span><br><span class="line">  delay(<span class="number">3000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> f2 = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> delay(<span class="number">1000</span>)</span><br><span class="line">  <span class="keyword">await</span> delay(<span class="number">1000</span>)</span><br><span class="line">  <span class="keyword">await</span> delay(<span class="number">3000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f1() <span class="comment">// 正常函数的执行</span></span><br></pre></td></tr></table></figure>
<p>可以看出f1执行后，可以发现三个函数其实是独立执行的，并非按照顺序串联执行，全部执行完成总共耗时大约3秒。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f2() <span class="comment">// 异步函数的执行</span></span><br></pre></td></tr></table></figure>
<p>f2执行后，可以发现三个延迟操作是安顺序执行的，即三个执行完总共耗时大约5秒，相对于f1，f2才符合我们delay需求。</p>
<p>这个delay只是模拟异步的一个流程，而在实际开发中，串联异步流程的执行顺序是很重要的一个点，如果采用传统的回调或者Promise的链式回调方式也是可以，只是异步函数写法更加简便，阅读更加清晰，符合直观流程的阅读感受。</p>
<h3 id="1-5-3-await关键字的左右值"><a href="#1-5-3-await关键字的左右值" class="headerlink" title="1.5.3 await关键字的左右值"></a>1.5.3 <code>await</code>关键字的左右值</h3><p>异步函数中使用<code>await</code>去做异步流程的等待，当<code>await</code>右边的Promise状态变为<code>resolved</code>时候，<code>await</code>关键字左边的值就变为<code>resolved</code>的值，当<code>await</code>右边的Promise状态改为<code>rejected</code>时，异步函数则会直接中断后续的<code>await</code>流程，直接返回<code>rejected</code>状态的Promise，用例子演示下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> asyncFn = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> valueA = <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(<span class="string">'A'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'first await: '</span> + valueA)</span><br><span class="line">  <span class="keyword">const</span> valueA2 = <span class="keyword">await</span> <span class="built_in">Promise</span>.resolve(valueA + valueA)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'second await: '</span> + valueA2)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> errValue = <span class="keyword">await</span> <span class="built_in">Promise</span>.reject(<span class="string">'err: '</span> + valueA2)</span><br><span class="line">  <span class="built_in">console</span>.log(errValue)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">asyncFn().catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'on catch -&gt; '</span> + err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>以上代码执行后依此输出的结果为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 'first await: A'</span></span><br><span class="line"><span class="comment">// 'second await: AA'</span></span><br><span class="line"><span class="comment">// 'on catch -&gt; err: AA'</span></span><br></pre></td></tr></table></figure>

<p>可以发现，最后一次我们reject时候，<code>errValue</code>并未被打印，也就是在这个<code>await</code>流程时候由于Promise的状态是<code>rejected</code>，会直接返回而不走之后的异步流程了。在前面两个异步流程中，由于状态是<code>resolved</code>，我们可以获得其值，并传入到下一步<code>await</code>流程中去继续。得力于这种方式，使得我们能够以同步流程的方式来组织异步流程，使代码更具可读性。</p>
<h1 id="2-函数的执行上下文this"><a href="#2-函数的执行上下文this" class="headerlink" title="2. 函数的执行上下文this"></a>2. 函数的执行上下文this</h1><p>函数的执行有个概念叫上下文，也就是this指针，在函数内部使用this可以获得上下文对象，由于JavaScript的灵活，同一个函数的执行，this往往并非都指向相同，先来了解下一个函数有哪几种改变上下文指向的执行方式：</p>
<ul>
<li>直接执行</li>
<li>对象属性访问方式执行</li>
<li>通过apply、call方式执行</li>
<li>通过bind方式执行</li>
</ul>
<h2 id="2-1-直接执行的this指向"><a href="#2-1-直接执行的this指向" class="headerlink" title="2.1 直接执行的this指向"></a>2.1 直接执行的this指向</h2><p>一个函数完成定义初始化后，可以在可访问到的作用域中直接执行，这个时候执行的指向为全局对象, 浏览器为<code>window</code>的全局对象，Node.js中为<code>global</code>对象, 在严格模式下都为<code>undefined</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hello() <span class="comment">// browser -&gt; window, Node.js -&gt; global</span></span><br><span class="line"></span><br><span class="line"><span class="meta">'use strict'</span></span><br><span class="line">hello() <span class="comment">// broswer -&gt; undefined, Node.js -&gt; undefined</span></span><br></pre></td></tr></table></figure>

<h2 id="2-2-对象属性访问执行的this指向"><a href="#2-2-对象属性访问执行的this指向" class="headerlink" title="2.2 对象属性访问执行的this指向"></a>2.2 对象属性访问执行的this指向</h2><p>若函数未通过显式地去绑定上下文，则通过访问对象属性方式执行，this指向就为该对象，我们先定义一个函数，然后分别将不同对象的属性指向到该函数，然后分别调用，看下结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Hello, I'm <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>!`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">  name: <span class="string">'a'</span>,</span><br><span class="line">  say: hello</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> b = &#123;</span><br><span class="line">  name: <span class="string">'b'</span>,</span><br><span class="line">  say: hello</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a.say() <span class="comment">// -&gt; "Hello, I'm a"</span></span><br><span class="line">b.say() <span class="comment">// -&gt; "Hello, I'm b"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 我们在新建一个对象c</span></span><br><span class="line"><span class="keyword">const</span> c = &#123;</span><br><span class="line">  name: <span class="string">'c'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将a.say赋值给c.say</span></span><br><span class="line">c.say = a.say</span><br><span class="line"></span><br><span class="line">c.say() <span class="comment">// -&gt; "Hello, I'm c"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 最后我们在全局对象window定义一个name属性，直接调用hello方法</span></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'God'</span></span><br><span class="line">hello() <span class="comment">// -&gt; "Hello, I'm God"</span></span><br></pre></td></tr></table></figure>

<p>可以发现同一个函数作为不同对象的属性被调用时候，this的指向动态地指向该对象</p>
<h2 id="2-3-通过apply、call方式执行"><a href="#2-3-通过apply、call方式执行" class="headerlink" title="2.3 通过apply、call方式执行"></a>2.3 通过apply、call方式执行</h2><p>函数的<code>apply</code>原型方法是实现调用函数时候，显式地传入上下文，并且参数可以通过数组的方式传入，此时函数执行时的<code>this</code>则指向传入的对象，<code>call</code>方法效果也是一样的，只是传入参数的方式为逗号隔开，也就是普通的传参方式，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'God'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> a = &#123; <span class="attr">name</span>: <span class="string">'a'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> b = &#123; <span class="attr">name</span>: <span class="string">'b'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* apply() */</span></span><br><span class="line">hello.apply(a) <span class="comment">// -&gt; 'a'</span></span><br><span class="line">hello.apply(b) <span class="comment">// -&gt; 'b'</span></span><br><span class="line"></span><br><span class="line">hello() <span class="comment">// -&gt; 'God'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* call() */</span></span><br><span class="line">hello.call(a) <span class="comment">// -&gt; 'a'</span></span><br><span class="line">hello.call(b) <span class="comment">// -&gt; 'b'</span></span><br><span class="line"></span><br><span class="line">hello() <span class="comment">// -&gt; 'God'</span></span><br></pre></td></tr></table></figure>

<h2 id="2-4-通过bind方式执行"><a href="#2-4-通过bind方式执行" class="headerlink" title="2.4 通过bind方式执行"></a>2.4 通过bind方式执行</h2><p>函数的<code>bind</code>的原型方法能显式地将当前函数与传入的上下文对象进行绑定，返回绑定完成的函数，原始函数的上下文指向逻辑仍不变，而绑定生成的新函数则实现了上下文的永久绑定，无论使用任何方式去调用，都不会改变<code>this</code>指向，即使是再次使用<code>bind</code>，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Hello, I'm <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'SuperHero'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jack = &#123; <span class="attr">name</span>: <span class="string">'Jack'</span> &#125;</span><br><span class="line"><span class="keyword">const</span> mary = &#123; <span class="attr">name</span>: <span class="string">'Mary'</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> helloSuperHero = hello.bind(<span class="built_in">window</span>)</span><br><span class="line"><span class="keyword">const</span> helloJack = hello.bind(jack)</span><br><span class="line"></span><br><span class="line">helloSuperHero() <span class="comment">// -&gt; 'Hello, I'm SuperHero'</span></span><br><span class="line">helloJack() <span class="comment">// -&gt; 'Hello, I'm Jack'</span></span><br><span class="line"></span><br><span class="line">helloSuperHero.call(jack) <span class="comment">// -&gt; 'Hello, I'm SuperHero'</span></span><br><span class="line">helloJack.apply(<span class="built_in">window</span>) <span class="comment">// -&gt; 'Hello, I'm Jack'</span></span><br><span class="line">helloJack.apply(mary) <span class="comment">// -&gt; 'Hello, I'm Jack'</span></span><br><span class="line"></span><br><span class="line">hello.call(jack) <span class="comment">// -&gt; 'Hello, I'm Jack'</span></span><br><span class="line">hello.call(mary) <span class="comment">// -&gt; 'Hello, I'm Mary'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> helloMary = helloJack.bind(mary) <span class="comment">// this的指向更改将不会生效</span></span><br><span class="line"><span class="keyword">const</span> marySayHello = hello.bind(mary) <span class="comment">// this的指向更改生效</span></span><br><span class="line"></span><br><span class="line">helloMary() <span class="comment">// -&gt; 'Hello, I'm Jack'</span></span><br><span class="line">marySayHello <span class="comment">// -&gt; 'Hello, I'm Mary'</span></span><br></pre></td></tr></table></figure>

<h2 id="2-5-箭头函数的this"><a href="#2-5-箭头函数的this" class="headerlink" title="2.5 箭头函数的this"></a>2.5 箭头函数的this</h2><p>一个箭头函数定义时，该函数的<code>this</code>指向会自动绑定，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = &#123;</span><br><span class="line">  data: <span class="literal">undefined</span>,</span><br><span class="line">  init() &#123;</span><br><span class="line">    <span class="keyword">const</span> checkDataValid = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> !!<span class="keyword">this</span>.data </span><br><span class="line">        &amp;&amp; <span class="keyword">typeof</span> <span class="keyword">this</span>.data === <span class="string">'object'</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> initData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.data = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!checkDataValid()) &#123;</span><br><span class="line">      initData()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(store.data) <span class="comment">// undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(store.init().data) <span class="comment">// &#123;&#125;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2018/09/10/%E7%AE%80%E5%8D%95%E6%96%B9%E4%BE%BF%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A5%E5%8F%A3URLSearchParams/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/10/%E7%AE%80%E5%8D%95%E6%96%B9%E4%BE%BF%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%8F%82%E6%95%B0%E5%BA%8F%E5%88%97%E5%8C%96%E6%8E%A5%E5%8F%A3URLSearchParams/" class="post-title-link" itemprop="url">简单方便的查询参数序列化接口URLSearchParams</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-10 16:36:19" itemprop="dateCreated datePublished" datetime="2018-09-10T16:36:19+08:00">2018-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在自定义封装GET请求方法时候，通常需要去序列号请求参数对象，将查询信息的对象转化成字符串，然后再拼接到url后面组成最终的url，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qs</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="built_in">Object</span>.keys(obj).map(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;obj[key]&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> url + (url.includes(<span class="string">'?'</span>) ? <span class="string">'&amp;'</span> :<span class="string">'?'</span>) + qs(params)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://localhost:3000/info'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> queryData = &#123;</span><br><span class="line">  username: <span class="string">'Test'</span>,</span><br><span class="line">    id: <span class="number">13</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">url = combine(url, queryData) <span class="comment">// --&gt; 'http://localhost:3000/info?usename=Test&amp;id=13'</span></span><br></pre></td></tr></table></figure>

<p>除了将对象序列号，有时也需要将url的请求参数解析成对象方便读取操作，如</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseParams</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> queryStr = url.split(<span class="string">'?'</span>)[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">var</span> queryData = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">    <span class="keyword">if</span> (queryStr) &#123;</span><br><span class="line">        queryStr = <span class="built_in">decodeURIComponent</span>(queryStr)</span><br><span class="line">        queryStr.split(<span class="string">'&amp;'</span>).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> keyVal = item.split(<span class="string">'='</span>)</span><br><span class="line">            queryData[keyVal[<span class="number">0</span>]] = keyVal[<span class="number">1</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queryData</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> url = <span class="string">'http://localhost:3000/info?username=Test&amp;id=13'</span></span><br><span class="line"><span class="keyword">var</span> query = parseParams(url) <span class="comment">// --&gt; &#123; username: 'Test', id: '13' &#125;</span></span><br></pre></td></tr></table></figure>

<p>虽然以上的需求能够自己简单的实现出来，但既然提供了标准的Web API，就应该积极使用原生提供的API，那么，现在就来了解一下标准Web API提供的URLSearchParams接口。</p>
<h1 id="1-URLSearchParams-构造函数"><a href="#1-URLSearchParams-构造函数" class="headerlink" title="1. URLSearchParams() 构造函数"></a>1. URLSearchParams() 构造函数</h1><p>URLSearchParams()构造函数可以传入一个url的search部分、[[key, value], …[key, value]]形式的一个数组或者一个URLSearchParams实例，解析并返回一个URLSearchParams实例，该实例能够实现对url中的查询字段信息进行读取、删除、再次序列号等操作，简单事例如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = <span class="keyword">new</span> URL(<span class="string">'http://localhost:3000/info?username=test&amp;id=10'</span>)</span><br><span class="line"><span class="keyword">var</span> search = url.search <span class="comment">// 'username=test&amp;id=10'</span></span><br><span class="line"><span class="keyword">var</span> searchParams = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> param <span class="keyword">of</span> searchParams.entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(param) <span class="comment">// --&gt; ['username', 'test'], ['id', '10']</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> searchParams2 = <span class="keyword">new</span> URLSearchParams([[<span class="string">'name'</span>, <span class="string">'hello'</span>], [<span class="string">'ok'</span>, <span class="number">1</span>]])</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> param <span class="keyword">of</span> searchParams2.entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(param) <span class="comment">// --&gt; ['name', 'hello], ['ok', '1']</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> searchParams3 = <span class="keyword">new</span> URLSearchParams(searchParams2)</span><br></pre></td></tr></table></figure>

<h2 id="1-1-toString-方法"><a href="#1-1-toString-方法" class="headerlink" title="1.1 toString() 方法"></a>1.1 toString() 方法</h2><p>该方法将URLSearchParams实例序列号，转换成url的search形式字符串，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line"></span><br><span class="line">params.append(<span class="string">'username'</span>, <span class="string">'jack'</span>)</span><br><span class="line">params.append(<span class="string">'id'</span>, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">params.toString() <span class="comment">// --&gt; 'username=jack&amp;id=10'</span></span><br></pre></td></tr></table></figure>



<h2 id="1-2-append-key-value-方法"><a href="#1-2-append-key-value-方法" class="headerlink" title="1.2 append(key, value) 方法"></a>1.2 append(key, value) 方法</h2><p>该方法能够添加请求字段信息，注意，该方法会允许重复添加相同key的数据，例如现在构造一个空的URLSearchParams实例，然后往里面添加需要查询的字段信息：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> searchParams = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">searchParams.append(<span class="string">'username'</span>, <span class="string">'jane'</span>)</span><br><span class="line">searchParams.append(<span class="string">'age'</span>, <span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> param <span class="keyword">of</span> searchParams) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(param) <span class="comment">// --&gt; ['username', 'jane'], ['age', '20']</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">searchParams.toString() <span class="comment">// --&gt; 'username=jane&amp;age=20'</span></span><br><span class="line"></span><br><span class="line">searchParams.append(<span class="string">'username'</span>, <span class="string">'jack'</span>)</span><br><span class="line"></span><br><span class="line">searchParams.toString() <span class="comment">// --&gt; 'username=jane&amp;age=20&amp;username=jack'</span></span><br></pre></td></tr></table></figure>



<h2 id="1-3-delete-key-方法"><a href="#1-3-delete-key-方法" class="headerlink" title="1.3 delete(key) 方法"></a>1.3 delete(key) 方法</h2><p>该方法能够删除一个查询字段，会删除对应key的所有匹配相，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用前面创建的searchParams实例: 'username=jane&amp;age=20&amp;username=jack'</span></span><br><span class="line">searchParams.delete(<span class="string">'username'</span>) <span class="comment">// 将会删除username=jane, username=jack</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> param <span class="keyword">of</span> searchParams.entries()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(param) <span class="comment">// --&gt; ['age', '20']</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">searchParams.toString() <span class="comment">// --&gt; 'age=20'</span></span><br></pre></td></tr></table></figure>

<h2 id="1-4-set-key-value-方法"><a href="#1-4-set-key-value-方法" class="headerlink" title="1.4 set(key, value) 方法"></a>1.4 set(key, value) 方法</h2><p>该方法能够搜索匹配传入的key值，并设置为value，若不存在则创建key，value信息，并且如果存在重复的key会删除其他值只保留一个，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">params.append(<span class="string">'id'</span>, <span class="number">1</span>)</span><br><span class="line">params.append(<span class="string">'id'</span>, <span class="number">2</span>)</span><br><span class="line">params.toString() <span class="comment">// --&gt; 'id=1&amp;id=2'</span></span><br><span class="line"></span><br><span class="line">params.set(<span class="string">'name'</span>, <span class="number">3</span>) <span class="comment">// 找到id字段并且有多个，删除多余只保留一个并赋值</span></span><br><span class="line">params.toString() <span class="comment">// --&gt; 'id=3'</span></span><br><span class="line"></span><br><span class="line">params.set(<span class="string">'age'</span>, <span class="number">20</span>) <span class="comment">// 未存在age字段，则创建</span></span><br><span class="line">params.toString() <span class="comment">// --&gt; 'id=3&amp;age=20'</span></span><br></pre></td></tr></table></figure>

<h2 id="1-5-get-key-方法"><a href="#1-5-get-key-方法" class="headerlink" title="1.5 get(key) 方法"></a>1.5 get(key) 方法</h2><p>该方法返回对应key的值，若有多个值对应则返回第一个值，若不存在则返回null，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> params = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">params.get(<span class="string">'name'</span>) <span class="comment">// --&gt; null</span></span><br><span class="line"></span><br><span class="line">params.set(<span class="string">'name'</span>, <span class="string">'jack'</span>)</span><br><span class="line">params.get(<span class="string">'name'</span>) <span class="comment">// --&gt; 'jack'</span></span><br><span class="line"></span><br><span class="line">params.append(<span class="string">'name'</span>, <span class="string">'jane'</span>)</span><br><span class="line">params.get（<span class="string">'name'</span>) <span class="comment">// --&gt; 'jack'</span></span><br><span class="line"></span><br><span class="line">params.toString() <span class="comment">// 'name=jack&amp;name=jane'</span></span><br></pre></td></tr></table></figure>

<h2 id="1-6-getAll-key-方法"><a href="#1-6-getAll-key-方法" class="headerlink" title="1.6 getAll(key) 方法"></a>1.6 getAll(key) 方法</h2><p>此方法返回匹配到的key对应的值，与get()方法不用，该方法将放回所有匹配的值，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">p.append(<span class="string">'id'</span>, <span class="number">1</span>)</span><br><span class="line">p.append(<span class="string">'id'</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">p.get(<span class="string">'id'</span>) <span class="comment">// --&gt; '1'</span></span><br><span class="line">p.getAll(<span class="string">'id'</span>) <span class="comment">// --&gt; ['1', '2']</span></span><br><span class="line"></span><br><span class="line">p.set(<span class="string">'id'</span>, <span class="number">0</span>)</span><br><span class="line">p.getAll(<span class="string">'id'</span>) <span class="comment">// --&gt; ['0']</span></span><br></pre></td></tr></table></figure>

<h2 id="1-7-has-key-方法"><a href="#1-7-has-key-方法" class="headerlink" title="1.7 has(key) 方法"></a>1.7 has(key) 方法</h2><p>此方法判断对应的key是否存在，返回布尔值，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">p.append(<span class="string">'id'</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">p.has(<span class="string">'id'</span>) <span class="comment">// --&gt; true</span></span><br><span class="line">p.has(<span class="string">'name'</span>) <span class="comment">// --&gt; false</span></span><br></pre></td></tr></table></figure>

<h2 id="1-8-sort-方法"><a href="#1-8-sort-方法" class="headerlink" title="1.8 sort() 方法"></a>1.8 sort() 方法</h2><p>该方法根据key的unicode字序进行对键值对排序，返回undefined值，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">p.append(<span class="string">'b'</span>, <span class="number">1</span>)</span><br><span class="line">p.append(<span class="string">'a'</span>, <span class="number">2</span>)</span><br><span class="line">p.append(<span class="string">'c'</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">p.toString() <span class="comment">// --&gt; 'b=1&amp;a=2&amp;c=3'</span></span><br><span class="line"></span><br><span class="line">p.sort() <span class="comment">// --&gt; undefined</span></span><br><span class="line">p.toString() <span class="comment">// --&gt; 'a=2&amp;b=1&amp;c=3'</span></span><br></pre></td></tr></table></figure>

<h2 id="1-9-keys-方法"><a href="#1-9-keys-方法" class="headerlink" title="1.9 keys() 方法"></a>1.9 keys() 方法</h2><p>该方法返回包含实例所有key的iterator对象，并且重复的key也将包含在内，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">p.append(<span class="string">'name'</span>, <span class="string">'jack'</span>)</span><br><span class="line">p.append(<span class="string">'age'</span>, <span class="number">20</span>)</span><br><span class="line">p.append(<span class="string">'id'</span>, <span class="number">0</span>)</span><br><span class="line">p.append(<span class="string">'id'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> keys = p.keys() <span class="comment">// 返回包含所有key的iterator对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> key <span class="keyword">of</span> keys) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(key) <span class="comment">// --&gt; 'name', 'age', 'id', 'id'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-20-values-方法"><a href="#1-20-values-方法" class="headerlink" title="1.20 values() 方法"></a>1.20 values() 方法</h2><p>该方法返回包含实例的所有value的iterator对象, 并且重复的key对应的value也包含在内，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">p.append(<span class="string">'name'</span>, <span class="string">'jack'</span>)</span><br><span class="line">p.append(<span class="string">'age'</span>, <span class="number">10</span>)</span><br><span class="line">p.append(<span class="string">'name'</span>, <span class="string">'jane'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> value <span class="keyword">of</span> p.values()) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value) <span class="comment">// --&gt; 'jack', '10', 'jane'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="1-21-entries-方法"><a href="#1-21-entries-方法" class="headerlink" title="1.21 entries() 方法"></a>1.21 entries() 方法</h2><p>该方法返回包含实例中的键值对数组的iterator对象，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams()</span><br><span class="line">p.append(<span class="string">'name'</span>, <span class="string">'jack'</span>)</span><br><span class="line">p.append(<span class="string">'id'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> val <span class="keyword">of</span> p) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(val) <span class="comment">// --&gt; ['name', 'jack'], ['id', '1']</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="2-关于传入的参数注意问题"><a href="#2-关于传入的参数注意问题" class="headerlink" title="2. 关于传入的参数注意问题"></a>2. 关于传入的参数注意问题</h1><p>前面讲到构造函数可以传入url的search部分字符串，所以，当传入不符合规格的字符串可以看下解析结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> search = <span class="string">'abc'</span></span><br><span class="line"><span class="keyword">var</span> p = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">p.toString() <span class="comment">// --&gt; 'abc='</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'a&amp;b'</span></span><br><span class="line">p = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">p.toString() <span class="comment">// --&gt; 'a=&amp;b='</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'a==='</span></span><br><span class="line">p = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">p.toString() <span class="comment">// --&gt; 'a=%3D%3D'</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'a&amp;&amp;b'</span></span><br><span class="line">p = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">p.toSring() <span class="comment">// --&gt; 'a=&amp;b='</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'&amp;&amp;&amp;'</span></span><br><span class="line">p = <span class="keyword">new</span> URLSearchParams(search)</span><br><span class="line">p.toString() <span class="comment">// --&gt; ''</span></span><br></pre></td></tr></table></figure>

<p>所以字符串的解析规则为：</p>
<ol>
<li>根据<code>&amp;</code>字符做拆分，去除空字符项，获取拆分后的字符串数组</li>
<li>然后再依次根据<code>=</code>做拆分，取第一个等号左边部分为’key’的值，右边为’value’的值</li>
</ol>
<p>通过代码简单的演示一下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'a&amp;&amp;b'</span></span><br><span class="line"><span class="comment">/* 解析 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parse</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/* 解码URI安全字符 */</span></span><br><span class="line">    str = <span class="built_in">decodeURIComponent</span>(str)</span><br><span class="line">    <span class="comment">/* 根据 &amp; 字符切割组 */</span></span><br><span class="line">  <span class="keyword">var</span> strArr = str.split(<span class="string">'&amp;'</span>) <span class="comment">// --&gt; ['a', '', 'b']</span></span><br><span class="line">    <span class="comment">/* 利用Boolean构造函数去除无效空值 */</span></span><br><span class="line">    strArr = strArr.filter(<span class="built_in">Boolean</span>) <span class="comment">// --&gt; ['a', 'b']</span></span><br><span class="line">  <span class="comment">/* 根据第一个 = 切割数据对 */</span></span><br><span class="line">    <span class="keyword">var</span> params = strArr.map(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> tmp = item.split(<span class="string">'='</span>)</span><br><span class="line">        <span class="comment">/* 补空或者合并尾 */</span></span><br><span class="line">        <span class="keyword">return</span> tmp &lt; <span class="number">2</span> ? tmp.concat(<span class="string">''</span>) : [tmp[<span class="number">0</span>], tmp.slice(<span class="number">1</span>).join(<span class="string">''</span>)]</span><br><span class="line">    &#125;) <span class="comment">// --&gt; [['a', ''], ['b', '']] </span></span><br><span class="line">    <span class="keyword">return</span> params</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 序列号 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">serialized</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = params.map(<span class="function"><span class="keyword">function</span> (<span class="params">pair</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pair.map(<span class="built_in">encodeURIComponent</span>).join(<span class="string">'='</span>)</span><br><span class="line">    &#125;).join(<span class="string">'&amp;'</span>)</span><br><span class="line">  <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试一下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str, params</span><br><span class="line"></span><br><span class="line"><span class="comment">// t1</span></span><br><span class="line">str = <span class="string">'abc'</span></span><br><span class="line">params = parse(str) <span class="comment">// --&gt; [['abc', '']]</span></span><br><span class="line">serialized(params) <span class="comment">// --&gt; 'abc='</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// t2</span></span><br><span class="line">str = <span class="string">'a&amp;b'</span></span><br><span class="line">params = parse(str) <span class="comment">// --&gt; [['a', ''], ['b', '']]</span></span><br><span class="line">serialized(params) <span class="comment">// --&gt; 'a=&amp;b=&amp;c='</span></span><br><span class="line"></span><br><span class="line">str = <span class="string">'a==='</span></span><br><span class="line">params = parse(str) <span class="comment">// --&gt; [['a', '==']]</span></span><br><span class="line">serialized(params) --&gt; <span class="string">'a=%3D%3D'</span></span><br><span class="line"></span><br><span class="line">str = <span class="string">'a&amp;&amp;b'</span></span><br><span class="line">params = parse(str) <span class="comment">// --&gt; [['a', ''], ['b', '']]</span></span><br><span class="line">serialized(params) <span class="comment">// --&gt; 'a=&amp;b='</span></span><br><span class="line"></span><br><span class="line">str = <span class="string">'&amp;&amp;&amp;'</span></span><br><span class="line">params = parse(str) <span class="comment">// []</span></span><br><span class="line">serialized(params)<span class="comment">// --&gt; ''</span></span><br></pre></td></tr></table></figure>

<p>有了系列关系的转换方法，便可以进步按照需求进行封装了，得力于强大的原生Web API，让我们的开发工作变得方便许多。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2018/09/10/%E7%AE%80%E6%B4%81%E6%98%8E%E4%BA%86%E7%9A%84Fetch-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/09/10/%E7%AE%80%E6%B4%81%E6%98%8E%E4%BA%86%E7%9A%84Fetch-API/" class="post-title-link" itemprop="url">简洁明了的Fetch API</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-10 14:22:50" itemprop="dateCreated datePublished" datetime="2018-09-10T14:22:50+08:00">2018-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>众所周知，前端的网络数据请求都基于事件的异步请求形态，基本的实现接口规范为：XMLHttpRequest、XMLHttpRequest2接口，此请求接口基于传统回调方式进行请求、回复的数据处理，较于目前主流的Promise处理方式有所不便，需要自行利用Promise进行封装。并且，将请求的所有配置全部杂糅，不能很好的进行解耦，为了解决例如以上的种种不便，于是有了新的数据请求接口标准<strong><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" target="_blank" rel="noopener">Fetch API</a></strong> 。</p>
<p><strong>Fetch API</strong>不仅能用于传统的Ajax数据请求，更重要的是能够与更现代化的一些技术进行结合，例如<strong>Service Worker， Cache API</strong>。并且，该接口的流程处理基于<strong>Promise</strong>,能更好的贴合现主流开发模式。<strong>Fetch API</strong>实现了<strong>Headers,Requests,Response,Body</strong>接口的结合，使结构与用户处理更加清晰。Fetch更像是对于Request，Response，Headers的一层封装，将整个请求过程封装成Promise的开发模式，使整个请求操作更加方便，具有更高的自定化。对于习惯于现代的Promise流程开发异步操作习惯的前端，在处理网络请求的步骤上可谓是如虎添翼，当然，你可以直接使用第三方库例如axios来进行你所喜欢的方式进行开发。在此，我们来粗浅地探讨一下Fetch API到底是什么，以及一些常规用法。</p>
<h1 id="1-Fetch"><a href="#1-Fetch" class="headerlink" title="1.Fetch"></a>1.Fetch</h1><p><img data-src="./%E7%AE%80%E6%B4%81%E6%98%8E%E4%BA%86%E7%9A%84Fetch-API/fetch.png" alt=""></p>
<h2 id="1-1-fetch-方法"><a href="#1-1-fetch-方法" class="headerlink" title="1.1 fetch()方法"></a>1.1 fetch()方法</h2><p>e.1 先来一个简单例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'/info'</span>).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>fetch()方法可以发起一个请求，方法可传入两个参数，第一个人为<strong>url</strong>，第二个为可选的<strong>init</strong>配置对象，该对象可以配置例如‘method‘，‘headers‘，’body‘等请求数据。</p>
<p>e.2 带init配置的例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">'/info'</span>, &#123; <span class="attr">headers</span>: &#123; <span class="string">"accept"</span>: <span class="string">"application/json"</span> &#125; &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>e.3 带参数的GET方法封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">queryStringify</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> str = <span class="built_in">Object</span>.keys(obj).map(<span class="function"><span class="params">key</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;obj[key]&#125;</span>`</span>).join(<span class="string">'&amp;'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">encodeURIComponent</span>(str)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 请求字符串可以使用URLSearchParams接口实现转换 */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">function qs(obj) &#123;</span></span><br><span class="line"><span class="comment">    return new URLSearchParams(obj).toString()</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getData</span>(<span class="params">url, params</span>) </span>&#123;</span><br><span class="line">  url = <span class="string">`<span class="subst">$&#123;url&#125;</span>?<span class="subst">$&#123;queryStringify(params)&#125;</span>`</span></span><br><span class="line">    <span class="keyword">return</span> fetch(url, &#123;</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">      <span class="string">'accept'</span>: <span class="string">'application/json'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 使用getData获取数据 */</span></span><br><span class="line">getData(<span class="string">'/info'</span>, &#123; <span class="attr">username</span>: <span class="string">'test'</span> &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line">&#125;).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>e.4 带body的POST方法封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">postData</span>(<span class="params">url, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> fetch(url, &#123;</span><br><span class="line">        method: <span class="string">'POST'</span>,</span><br><span class="line">        headers: &#123;</span><br><span class="line">            <span class="string">'content-type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">            <span class="string">'accept'</span>: <span class="string">'application/json'</span></span><br><span class="line">        &#125;,</span><br><span class="line">        data: <span class="built_in">JSON</span>.stringify(data) <span class="comment">// 对应 headers中的content-type</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2018/08/13/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/13/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">快速排序算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-13 16:23:48" itemprop="dateCreated datePublished" datetime="2018-08-13T16:23:48+08:00">2018-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="快速排序算法研究"><a href="#快速排序算法研究" class="headerlink" title="快速排序算法研究"></a>快速排序算法研究</h1><p>快速排序算法利用分治原则，将序列分成左右两份，紧接递归去划分，最终完成排序。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义:"></a>定义:</h2><ol>
<li>arr 原数组</li>
<li>i 从左到右数组下标</li>
<li>j 从右到左数组下标</li>
<li>swap(arr, a, b) 交换a，b两个位置元素</li>
</ol>
<h2 id="1-找寻中间值"><a href="#1-找寻中间值" class="headerlink" title="1.找寻中间值"></a>1.找寻中间值</h2><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-&gt; 如果 <span class="built_in">i</span> !== <span class="built_in">j</span> 从左到右遍历:</span><br><span class="line">    如果: arr[<span class="built_in">i</span>] &lt;= arr[<span class="built_in">j</span>]</span><br><span class="line">      -&gt; 右下标<span class="built_in">j</span>--</span><br><span class="line">      -&gt; 继续遍历比较</span><br><span class="line">    如果: arr[<span class="built_in">i</span>] &gt; arr[<span class="built_in">j</span>]</span><br><span class="line">      -&gt; swap(arr, <span class="built_in">i</span>, <span class="built_in">j</span>) 交换元素</span><br><span class="line">      -&gt; 左下标<span class="built_in">i</span>++</span><br><span class="line">      -&gt; 继续遍历比较</span><br><span class="line"></span><br><span class="line">-&gt; 遍历完成，当前<span class="built_in">i</span>的值为要寻找的中间位置，这时序列arr被当前中间元素分割成左右两子序列</span><br></pre></td></tr></table></figure>

<h2 id="2-判断左右子序列长度，并递归执行遍历"><a href="#2-判断左右子序列长度，并递归执行遍历" class="headerlink" title="2.判断左右子序列长度，并递归执行遍历"></a>2.判断左右子序列长度，并递归执行遍历</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-&gt; 如果子序列长度(arr.slice(start, i).length) 大于<span class="number">1</span></span><br><span class="line">  -&gt; 继续遍历排序子序列</span><br></pre></td></tr></table></figure>

<h2 id="3-递归遍历完成，最终完成排序"><a href="#3-递归遍历完成，最终完成排序" class="headerlink" title="3.递归遍历完成，最终完成排序"></a>3.递归遍历完成，最终完成排序</h2><h2 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">-&gt;</span> <span class="attr">arr:</span> <span class="string">(</span> <span class="number">3</span><span class="string">,</span> <span class="number">19</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">21</span><span class="string">,</span> <span class="number">82</span><span class="string">,</span> <span class="number">12</span><span class="string">,</span> <span class="number">42</span> <span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="attr">s1:</span></span><br><span class="line">  <span class="string">[</span> <span class="number">32</span> <span class="string">],</span> <span class="number">19</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">21</span><span class="string">,</span> <span class="number">82</span><span class="string">,</span> <span class="number">12</span><span class="string">,</span> <span class="string">[</span> <span class="number">42</span> <span class="string">]</span></span><br><span class="line">  <span class="string">--------------------------------</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">i</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j</span> <span class="string">=</span> <span class="number">6</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[i]</span> <span class="string">=</span> <span class="number">32</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[j]</span> <span class="string">=</span> <span class="number">42</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="number">32</span> <span class="string">&lt;</span> <span class="number">42</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j--</span></span><br><span class="line"></span><br><span class="line"><span class="attr">s2:</span></span><br><span class="line">  <span class="string">[</span> <span class="number">32</span> <span class="string">],</span> <span class="number">19</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">21</span><span class="string">,</span> <span class="number">82</span><span class="string">,</span> <span class="string">[</span> <span class="number">12</span> <span class="string">],</span> <span class="number">42</span></span><br><span class="line">  <span class="string">--------------------------------</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">i</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j</span> <span class="string">=</span> <span class="number">5</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[i]</span> <span class="string">=</span> <span class="number">32</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[j]</span> <span class="string">=</span> <span class="number">12</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="number">32</span> <span class="string">&gt;</span> <span class="number">12</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">swap[32,</span> <span class="number">12</span><span class="string">]</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">i++</span></span><br><span class="line"></span><br><span class="line"><span class="attr">s3:</span></span><br><span class="line">  <span class="number">12</span><span class="string">,</span> <span class="string">[</span> <span class="number">19</span> <span class="string">],</span> <span class="number">6</span><span class="string">,</span> <span class="number">21</span><span class="string">,</span> <span class="number">82</span><span class="string">,</span> <span class="string">[</span> <span class="number">32</span> <span class="string">],</span> <span class="number">42</span></span><br><span class="line">  <span class="string">--------------------------------</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">i</span> <span class="string">=</span> <span class="number">1</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j</span> <span class="string">=</span> <span class="number">5</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[i]</span> <span class="string">=</span> <span class="number">19</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[j]</span> <span class="string">=</span> <span class="number">32</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="number">19</span> <span class="string">&lt;</span> <span class="number">32</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j--</span></span><br><span class="line"></span><br><span class="line"><span class="attr">s4:</span></span><br><span class="line">  <span class="number">12</span> <span class="string">,</span> <span class="number">19</span><span class="string">,</span> <span class="string">[</span> <span class="number">6</span> <span class="string">],</span> <span class="number">21</span><span class="string">,</span> <span class="number">82</span><span class="string">,</span> <span class="string">[</span> <span class="number">32</span> <span class="string">],</span> <span class="number">42</span></span><br><span class="line">  <span class="string">--------------------------------</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">i</span> <span class="string">=</span> <span class="number">2</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j</span> <span class="string">=</span> <span class="number">5</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[i]</span> <span class="string">=</span> <span class="number">6</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">arr[j]</span> <span class="string">=</span> <span class="number">32</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="number">6</span> <span class="string">&lt;</span> <span class="number">32</span></span><br><span class="line">  <span class="string">=&gt;</span> <span class="string">j--</span></span><br><span class="line"></span><br><span class="line"><span class="string">...</span></span><br><span class="line"></span><br><span class="line"><span class="string">当i=j=4时，arr[i]</span> <span class="string">=</span> <span class="number">32</span><span class="string">，此时找到中间元素并分割数组为左右两子序列</span></span><br><span class="line"></span><br><span class="line"><span class="string">arr:</span> <span class="string">(12,</span> <span class="number">19</span><span class="string">,</span> <span class="number">6</span><span class="string">,</span> <span class="number">21</span><span class="string">),</span> <span class="string">[</span> <span class="number">32</span> <span class="string">],</span> <span class="string">(82,</span> <span class="number">42</span><span class="string">)</span></span><br><span class="line"></span><br><span class="line"><span class="string">递归重复以上动作对左右两子序列进行排序</span></span><br></pre></td></tr></table></figure>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quickSort</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* 元素交换 */</span></span><br><span class="line">  <span class="keyword">var</span> swap = <span class="function"><span class="keyword">function</span> (<span class="params">arr, a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = arr[a]</span><br><span class="line">    arr[a] = arr[b]</span><br><span class="line">    arr[b] = tmp</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 排序操作 */</span></span><br><span class="line">  <span class="keyword">var</span> sorting = <span class="function"><span class="keyword">function</span> (<span class="params">arr, i, j</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> start = i</span><br><span class="line">    <span class="keyword">var</span> end = j</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 寻找中间值 */</span></span><br><span class="line">    <span class="keyword">while</span> (i !== j) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[i] &lt;= arr[j]) &#123;</span><br><span class="line">        j--</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        swap(arr, i, j)</span><br><span class="line">        i++</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 递归排序左子序列 */</span></span><br><span class="line">    <span class="keyword">if</span> (arr.slice(start, i).length &gt; <span class="number">1</span>) sorting(arr, start, i - <span class="number">1</span>)</span><br><span class="line">    <span class="comment">/* 递归排序右子序列 */</span></span><br><span class="line">    <span class="keyword">if</span> (arr.slice(i, end).length &gt; <span class="number">1</span>) sorting(arr, i + <span class="number">1</span>, end)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* 执行排序操作 */</span></span><br><span class="line">  sorting(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2018/08/07/%E5%8D%83%E5%88%86%E4%BD%8D%E6%A0%BC%E5%BC%8F%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/07/%E5%8D%83%E5%88%86%E4%BD%8D%E6%A0%BC%E5%BC%8F%E5%8C%96/" class="post-title-link" itemprop="url">千分位格式化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-07 11:37:12" itemprop="dateCreated datePublished" datetime="2018-08-07T11:37:12+08:00">2018-08-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="千分位数字格式化"><a href="#千分位数字格式化" class="headerlink" title="千分位数字格式化"></a>千分位数字格式化</h1><p>数字千分位格式化是一个常用的功能，简单实现一下千分位格式化函数</p>
<h2 id="方法1-toLocaleString"><a href="#方法1-toLocaleString" class="headerlink" title="方法1 toLocaleString()"></a>方法1 toLocaleString()</h2><p>利用系统自带的数字格式进行千分位输出，使用toLocaleString</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fmt</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num.toLocaleString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方法快速简单，不过必须保证所在环境地区的配置格式默认是千分位隔开。</p>
<h2 id="方法2-数组法"><a href="#方法2-数组法" class="headerlink" title="方法2 数组法"></a>方法2 数组法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fmt</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> aStr = num.toString().split(<span class="string">''</span>) <span class="comment">// 转成数组或直接遍历字符串</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = aStr.length - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">3</span> === <span class="number">0</span> &amp;&amp; i !== <span class="number">0</span>) aStr.splice(i, <span class="number">0</span>, <span class="string">','</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> aStr.join(<span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方法3-字符串法"><a href="#方法3-字符串法" class="headerlink" title="方法3 字符串法"></a>方法3 字符串法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fmt</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">    str = num.toString()</span><br><span class="line">    <span class="keyword">let</span> sStr = <span class="string">''</span></span><br><span class="line">    <span class="keyword">while</span> (str.length &gt; <span class="number">3</span>) &#123;</span><br><span class="line">        sStr = <span class="string">','</span> + str.substr(<span class="number">-3</span>) + sStr</span><br><span class="line">        str = str.substring(<span class="number">0</span>, str.length - <span class="number">3</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (str) sStr = str + sStr</span><br><span class="line">    <span class="keyword">return</span> sStr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方法4-正则匹配"><a href="#方法4-正则匹配" class="headerlink" title="方法4 正则匹配"></a>方法4 正则匹配</h2><p>使用正则匹配，利用 ** \d ** 与 ** (?=), (?:) ** 断言，匹配三个数字为组并添加 ** , **</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fmt</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num.toString().replace(<span class="regexp">/(\d)(?=(?:\d&#123;3&#125;)+$)/g</span>, <span class="string">'$1,'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.dymox.top/2018/08/04/%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars.githubusercontent.com/u/14145521?v=4">
      <meta itemprop="name" content="TanKingKhun">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="TanKingKhun's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/08/04/%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D/" class="post-title-link" itemprop="url">arrayUnique</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-04 09:22:28" itemprop="dateCreated datePublished" datetime="2018-08-04T09:22:28+08:00">2018-08-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-26 19:40:14" itemprop="dateModified" datetime="2021-06-26T19:40:14+08:00">2021-06-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="数组元素的去重方法"><a href="#数组元素的去重方法" class="headerlink" title="数组元素的去重方法"></a>数组元素的去重方法</h1><p>对于数组的去重，在现实开发工作中会有许多的使用场景，而原生api并未提供，对于实际的开发工作中，往往直接使用成熟的第三方工具库，如：lodash进行功能扩展，在此则对去重算法的简单探讨与应用。</p>
<h2 id="方式1-临时数组比对"><a href="#方式1-临时数组比对" class="headerlink" title="方式1: 临时数组比对"></a>方式1: 临时数组比对</h2><p>1.定义一个临时数组变量tmp，用于存放不重复元素<br>2.遍历原始数组，并在临时数组中查询，若不存在于临时数组，则push进临时数组tmp<br>3.遍历完成返回临时数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* method 1 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tmp = [],</span><br><span class="line">      i = <span class="number">0</span>,</span><br><span class="line">      len = arr.length</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; len; i++) &#123; <span class="comment">// 其他遍历方式，forEach，map等等</span></span><br><span class="line">    <span class="keyword">if</span> (tmp.indexOf(arr[i]) &gt; <span class="number">-1</span>) <span class="keyword">continue</span> <span class="comment">// 其他查询方式</span></span><br><span class="line">    tmp.push(arr[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> tmp</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* method 2 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tmp = []</span><br><span class="line">  <span class="keyword">return</span> arr.filter(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> tmp.indexOf(item) === <span class="number">-1</span> &amp;&amp; tmp.push(item)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="方式2：临时map快速查询"><a href="#方式2：临时map快速查询" class="headerlink" title="方式2：临时map快速查询"></a>方式2：临时map快速查询</h2><p>1.定义一个空对象tmp用于标记不重复元素，利用key的hash特性实现快速查找<br>2.遍历原始数组，并在标记map中查询，若不存在则标记并返回该元素<br>3.完成遍历返回结果数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* method 1 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> tmp = &#123;&#125;,</span><br><span class="line">      ret = [],</span><br><span class="line">      i = <span class="number">0</span>,</span><br><span class="line">      len = arr.length</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (tmp[arr[i]]) <span class="keyword">continue</span></span><br><span class="line">    tmp[arr[i]] = <span class="literal">true</span></span><br><span class="line">    ret.push(arr[i])</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* method 2 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> mark = &#123;&#125;</span><br><span class="line">  <span class="keyword">return</span> arr.fitler(<span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !mark[item] &amp;&amp; mark[item] = <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="方式3：利用ES6-Array-from-Set原生API快速去重"><a href="#方式3：利用ES6-Array-from-Set原生API快速去重" class="headerlink" title="方式3：利用ES6 Array.from, Set原生API快速去重"></a>方式3：利用ES6 Array.from, Set原生API快速去重</h2><p>1.Set为不重复的元素集合<br>2.Array.from方法可以将ArrayLike数据结构转换成数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* method 1 */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">unique</span>(<span class="params">arr</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Array</span>.from(<span class="keyword">new</span> <span class="built_in">Set</span>(arr))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上是数组的一些去重方法，但是仅限于对于基本数据类型的去重，对于引用类型则需要做深度全等对比</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="TanKingKhun"
      src="https://avatars.githubusercontent.com/u/14145521?v=4">
  <p class="site-author-name" itemprop="name">TanKingKhun</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/chenjk110" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;chenjk110" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chenjk110@qq.com" title="E-Mail → mailto:chenjk110@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.wangjianfeng.net/" title="http:&#x2F;&#x2F;www.wangjianfeng.net&#x2F;" rel="noopener" target="_blank">YouSeeSeeMe</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.fidding.me/" title="http:&#x2F;&#x2F;www.fidding.me&#x2F;" rel="noopener" target="_blank">Fidding</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://zhujp.net/" title="http:&#x2F;&#x2F;zhujp.net&#x2F;" rel="noopener" target="_blank">Venus</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://toad.dev/" title="https:&#x2F;&#x2F;toad.dev&#x2F;" rel="noopener" target="_blank">Toad.Woo</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">TanKingKhun</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  













<script data-pjax>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdnjs.cloudflare.com/ajax/libs/mermaid/8.4.8/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


    <div id="pjax">
  

  

    </div>
</body>
</html>
